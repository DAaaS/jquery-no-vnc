!function($){function Websock(){"use strict";this._websocket=null,this._rQi=0,this._rQlen=0,this._rQbufferSize=4194304,this._rQmax=this._rQbufferSize/8,this._rQ=null,this._sQbufferSize=10240,this._sQlen=0,this._sQ=null,this._mode="binary",this.maxBufferedAmount=200,this._eventHandlers={message:function(){},open:function(){},close:function(){},error:function(){}}}function DES(t){"use strict";function e(t){var e,i,s,r,n,o,_,h,a,c,u=[],l=[],d=[];for(i=0,s=56;i<56;++i,s-=8)s+=s<-5?65:s<-3?31:s<-1?63:27===s?35:0,r=7&s,u[i]=0!==(t[s>>>3]&1<<r)?1:0;for(e=0;e<16;++e){for(r=e<<1,n=r+1,d[r]=d[n]=0,o=28;o<59;o+=28)for(i=o-28;i<o;++i)s=i+v[e],s<o?l[i]=u[s]:l[i]=u[s-28];for(i=0;i<24;++i)0!==l[b[i]]&&(d[r]|=1<<23-i),0!==l[b[i+24]]&&(d[n]|=1<<23-i)}for(e=0,a=0,c=0;e<16;++e)_=d[a++],h=d[a++],w[c]=(16515072&_)<<6,w[c]|=(4032&_)<<10,w[c]|=(16515072&h)>>>10,w[c]|=(4032&h)>>>6,++c,w[c]=(258048&_)<<12,w[c]|=(63&_)<<16,w[c]|=(258048&h)>>>4,w[c]|=63&h,++c}function i(t){var e,i,s,r,n=0,o=t.slice(),_=0;for(i=o[n++]<<24|o[n++]<<16|o[n++]<<8|o[n++],s=o[n++]<<24|o[n++]<<16|o[n++]<<8|o[n++],r=252645135&(i>>>4^s),s^=r,i^=r<<4,r=65535&(i>>>16^s),s^=r,i^=r<<16,r=858993459&(s>>>2^i),i^=r,s^=r<<2,r=16711935&(s>>>8^i),i^=r,s^=r<<8,s=s<<1|s>>>31&1,r=2863311530&(i^s),i^=r,s^=r,i=i<<1|i>>>31&1,n=0;n<8;++n)r=s<<28|s>>>4,r^=w[_++],e=g[63&r],e|=f[r>>>8&63],e|=l[r>>>16&63],e|=c[r>>>24&63],r=s^w[_++],e|=y[63&r],e|=p[r>>>8&63],e|=d[r>>>16&63],e|=u[r>>>24&63],i^=e,r=i<<28|i>>>4,r^=w[_++],e=g[63&r],e|=f[r>>>8&63],e|=l[r>>>16&63],e|=c[r>>>24&63],r=i^w[_++],e|=y[63&r],e|=p[r>>>8&63],e|=d[r>>>16&63],e|=u[r>>>24&63],s^=e;for(s=s<<31|s>>>1,r=2863311530&(i^s),i^=r,s^=r,i=i<<31|i>>>1,r=16711935&(i>>>8^s),s^=r,i^=r<<8,r=858993459&(i>>>2^s),s^=r,i^=r<<2,r=65535&(s>>>16^i),i^=r,s^=r<<16,r=252645135&(s>>>4^i),i^=r,s^=r<<4,r=[s,i],n=0;n<8;n++)o[n]=(r[n>>>2]>>>8*(3-n%4))%256,o[n]<0&&(o[n]+=256);return o}function s(t){return i(t.slice(0,8)).concat(i(t.slice(8,16)))}var r,n,o,_,h,a,c,u,l,d,f,p,g,y,b=[13,16,10,23,0,4,2,27,14,5,20,9,22,18,11,3,25,7,15,6,26,19,12,1,40,51,30,36,46,54,29,39,50,44,32,47,43,48,38,55,33,52,45,41,49,35,28,31],v=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],m=0,w=[];return r=65536,n=1<<24,o=r|n,_=4,h=1024,a=_|h,c=[o|h,m|m,r|m,o|a,o|_,r|a,m|_,r|m,m|h,o|h,o|a,m|h,n|a,o|_,n|m,m|_,m|a,n|h,n|h,r|h,r|h,o|m,o|m,n|a,r|_,n|_,n|_,r|_,m|m,m|a,r|a,n|m,r|m,o|a,m|_,o|m,o|h,n|m,n|m,m|h,o|_,r|m,r|h,n|_,m|h,m|_,n|a,r|a,o|a,r|_,o|m,n|a,n|_,m|a,r|a,o|h,m|a,n|h,n|h,m|m,r|_,r|h,m|m,o|_],r=1<<20,n=1<<31,o=r|n,_=32,h=32768,a=_|h,u=[o|a,n|h,m|h,r|a,r|m,m|_,o|_,n|a,n|_,o|a,o|h,n|m,n|h,r|m,m|_,o|_,r|h,r|_,n|a,m|m,n|m,m|h,r|a,o|m,r|_,n|_,m|m,r|h,m|a,o|h,o|m,m|a,m|m,r|a,o|_,r|m,n|a,o|m,o|h,m|h,o|m,n|h,m|_,o|a,r|a,m|_,m|h,n|m,m|a,o|h,r|m,n|_,r|_,n|a,n|_,r|_,r|h,m|m,n|h,m|a,n|m,o|_,o|a,r|h],r=1<<17,n=1<<27,o=r|n,_=8,h=512,a=_|h,l=[m|a,o|h,m|m,o|_,n|h,m|m,r|a,n|h,r|_,n|_,n|_,r|m,o|a,r|_,o|m,m|a,n|m,m|_,o|h,m|h,r|h,o|m,o|_,r|a,n|a,r|h,r|m,n|a,m|_,o|a,m|h,n|m,o|h,n|m,r|_,m|a,r|m,o|h,n|h,m|m,m|h,r|_,o|a,n|h,n|_,m|h,m|m,o|_,n|a,r|m,n|m,o|a,m|_,r|a,r|h,n|_,o|m,n|a,m|a,o|m,r|a,m|_,o|_,r|h],r=8192,n=1<<23,o=r|n,_=1,h=128,a=_|h,d=[o|_,r|a,r|a,m|h,o|h,n|a,n|_,r|_,m|m,o|m,o|m,o|a,m|a,m|m,n|h,n|_,m|_,r|m,n|m,o|_,m|h,n|m,r|_,r|h,n|a,m|_,r|h,n|h,r|m,o|h,o|a,m|a,n|h,n|_,o|m,o|a,m|a,m|m,m|m,o|m,r|h,n|h,n|a,m|_,o|_,r|a,r|a,m|h,o|a,m|a,m|_,r|m,n|_,r|_,o|h,n|a,r|_,r|h,n|m,o|_,m|h,n|m,r|m,o|h],r=1<<25,n=1<<30,o=r|n,_=256,h=1<<19,a=_|h,f=[m|_,r|a,r|h,o|_,m|h,m|_,n|m,r|h,n|a,m|h,r|_,n|a,o|_,o|h,m|a,n|m,r|m,n|h,n|h,m|m,n|_,o|a,o|a,r|_,o|h,n|_,m|m,o|m,r|a,r|m,o|m,m|a,m|h,o|_,m|_,r|m,n|m,r|h,o|_,n|a,r|_,n|m,o|h,r|a,n|a,m|_,r|m,o|h,o|a,m|a,o|m,o|a,r|h,m|m,n|h,o|m,m|a,r|_,n|_,m|h,m|m,n|h,r|a,n|_],r=1<<22,n=1<<29,o=r|n,_=16,h=16384,a=_|h,p=[n|_,o|m,m|h,o|a,o|m,m|_,o|a,r|m,n|h,r|a,r|m,n|_,r|_,n|h,n|m,m|a,m|m,r|_,n|a,m|h,r|h,n|a,m|_,o|_,o|_,m|m,r|a,o|h,m|a,r|h,o|h,n|m,n|h,m|_,o|_,r|h,o|a,r|m,m|a,n|_,r|m,n|h,n|m,m|a,n|_,o|a,r|h,o|m,r|a,o|h,m|m,o|_,m|_,m|h,o|m,r|a,m|h,r|_,n|a,m|m,o|h,n|m,r|_,n|a],r=1<<21,n=1<<26,o=r|n,_=2,h=2048,a=_|h,g=[r|m,o|_,n|a,m|m,m|h,n|a,r|a,o|h,o|a,r|m,m|m,n|_,m|_,n|m,o|_,m|a,n|h,r|a,r|_,n|h,n|_,o|m,o|h,r|_,o|m,m|h,m|a,o|a,r|h,m|_,n|m,r|h,n|m,r|h,r|m,n|a,n|a,o|_,o|_,m|_,r|_,n|m,n|h,r|m,o|h,m|a,r|a,o|h,m|a,n|_,o|a,o|m,r|h,m|m,m|_,o|a,m|m,r|a,o|m,m|h,n|_,n|h,m|h,r|_],r=1<<18,n=1<<28,o=r|n,_=64,h=4096,a=_|h,y=[n|a,m|h,r|m,o|a,n|m,n|a,m|_,n|m,r|_,o|m,o|a,r|h,o|h,r|a,m|h,m|_,o|m,n|_,n|h,m|a,r|h,r|_,o|_,o|h,m|a,m|m,m|m,o|_,n|_,n|h,r|a,r|m,r|a,r|m,o|h,m|h,m|_,o|_,m|h,r|a,n|h,m|_,n|_,o|m,o|_,n|m,r|m,n|a,m|m,o|a,r|_,n|_,o|m,n|h,n|a,m|m,o|a,r|h,r|h,m|a,m|a,r|_,n|m,o|h],e(t),{encrypt:s}}function KeyEventDecoder(t,e){"use strict";function i(t){for(var i=0;i<t.length;++i)e(t[i])}function s(i,s){var r={type:s},n=kbdUtil.getKey(i);n&&(r.keyId=n);var o=kbdUtil.getKeysym(i),_=t.hasShortcutModifier()||!!t.activeCharModifier();o&&("keydown"!==s||kbdUtil.nonCharacterKey(i)||_)&&(r.keysym=o);var h=16===i.keyCode||"Shift"===i.key,a=!h&&("keydown"!==s||t.hasShortcutModifier()||!!kbdUtil.nonCharacterKey(i)),c="keydown"===s&&t.activeCharModifier()&&!kbdUtil.nonCharacterKey(i),u=t.activeCharModifier();if(u&&o){for(var l=!1,d=0;d<u.length;++d)u[d]===o.keysym&&(l=!0);"keypress"!==s||l||(r.escape=t.activeCharModifier())}return c&&e({type:"stall"}),e(r),a}return{keydown:function(e){return i(t.keydown(e)),s(e,"keydown")},keypress:function(t){return s(t,"keypress")},keyup:function(e){return i(t.keyup(e)),s(e,"keyup")},syncModifiers:function(e){i(t.syncAny(e))},releaseAll:function(){e({type:"releaseall"})}}}function VerifyCharModifier(t){"use strict";function e(){if(!s)for(var r=function(){clearTimeout(s),s=null,e()};0!==i.length;){var n=i[0];switch(i=i.splice(1),n.type){case"stall":return void(s=setTimeout(r,5));case"keydown":0!==i.length&&"keypress"===i[0].type&&(!i[0].escape||n.keysym&&n.keysym.keysym===i[0].keysym.keysym||(n.escape=i[0].escape),n.keysym=i[0].keysym,i=i.splice(1))}"stall"!==n.type&&t(n)}}var i=[],s=null;return function(t){i.push(t),e()}}function TrackKeyState(t){"use strict";var e=[];return function(i){var s=0!==e.length?e[e.length-1]:null;switch(i.type){case"keydown":s&&i.keyId&&s.keyId===i.keyId||(s={keyId:i.keyId,keysyms:{}},e.push(s)),i.keysym&&(s.keysyms[i.keysym.keysym]=i.keysym,s.ignoreKeyPress=!0,t(i));break;case"keypress":s||(s={keyId:i.keyId,keysyms:{}},e.push(s)),i.keysym||console.log("keypress with no keysym:",i),i.keysym&&!s.ignoreKeyPress&&(s.keysyms[i.keysym.keysym]=i.keysym,i.type="keydown",t(i));break;case"keyup":if(0===e.length)return;for(var r=null,n=0;n!==e.length;++n)if(e[n].keyId===i.keyId){r=n;break}null===r&&(r=e.length-1);var o=e.splice(r,1)[0],_=function(){function t(){}return function(e){return t.prototype=e,new t}}();for(var h in o.keysyms){var a=_(i);a.keysym=o.keysyms[h],t(a)}break;case"releaseall":for(var n=0;n<e.length;++n)for(var h in e[n].keysyms){var c=e[n].keysyms[h];t({keyId:0,keysym:c,type:"keyup"})}e=[]}}}function EscapeModifiers(t){"use strict";return function(e){if("keydown"!==e.type||void 0===e.escape)return void t(e);for(var i=0;i<e.escape.length;++i)t({type:"keyup",keyId:0,keysym:keysyms.lookup(e.escape[i])});t(e);for(var i=0;i<e.escape.length;++i)t({type:"keydown",keyId:0,keysym:keysyms.lookup(e.escape[i])})}}var Util={},addFunc=function(t,e,i){t.prototype[e]||Object.defineProperty(t.prototype,e,{enumerable:!1,value:i})};addFunc(Array,"push8",function(t){"use strict";this.push(255&t)}),addFunc(Array,"push16",function(t){"use strict";this.push(t>>8&255,255&t)}),addFunc(Array,"push32",function(t){"use strict";this.push(t>>24&255,t>>16&255,t>>8&255,255&t)}),addFunc(Array,"map",function(t){"use strict";var e=this.length;if("function"!=typeof t)throw new TypeError;for(var i=new Array(e),s=arguments[1],r=0;r<e;r++)r in this&&(i[r]=t.call(s,this[r],r,this));return i}),addFunc(Array,"indexOf",function(t){"use strict";var e=this.length>>>0,i=Number(arguments[1])||0;for(i=i<0?Math.ceil(i):Math.floor(i),i<0&&(i+=e);i<e;i++)if(i in this&&this[i]===t)return i;return-1}),Object.keys||(Object.keys=function(){"use strict";var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],s=i.length;return function(r){if("object"!=typeof r&&("function"!=typeof r||null===r))throw new TypeError("Object.keys called on non-object");var n,o,_=[];for(n in r)t.call(r,n)&&_.push(n);if(e)for(o=0;o<s;o++)t.call(r,i[o])&&_.push(i[o]);return _}}()),addFunc(Function,"bind",function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,s=function(){},r=function(){return i.apply(this instanceof s&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return s.prototype=this.prototype,r.prototype=new s,r}),window.requestAnimFrame=function(){"use strict";return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),Util._log_level="warn",Util.init_logging=function(t){"use strict";switch("undefined"==typeof t?t=Util._log_level:Util._log_level=t,"undefined"==typeof window.console&&("undefined"!=typeof window.opera?window.console={log:window.opera.postError,warn:window.opera.postError,error:window.opera.postError}:window.console={log:function(t){},warn:function(t){},error:function(t){}}),Util.Debug=Util.Info=Util.Warn=Util.Error=function(t){},t){case"debug":Util.Debug=function(t){console.log(t)};case"info":Util.Info=function(t){console.log(t)};case"warn":Util.Warn=function(t){console.warn(t)};case"error":Util.Error=function(t){console.error(t)};case"none":break;default:throw new Error("invalid logging type '"+t+"'")}},Util.get_logging=function(){return Util._log_level},Util.init_logging(),Util.make_property=function(t,e,i,s){"use strict";var r;r="arr"===s?function(t){return"undefined"!=typeof t?this["_"+e][t]:this["_"+e]}:function(){return this["_"+e]};var n,o=function(t){return t?function(i,s){"undefined"!=typeof s?this["_"+e][s]=t(i):this["_"+e]=t(i)}:function(t,i){"undefined"!=typeof i?this["_"+e][i]=t:this["_"+e]=t}};if("bool"===s)n=o(function(t){return!(!t||t in{0:1,no:1,"false":1})});else if("int"===s)n=o(function(t){return parseInt(t,10)});else if("float"===s)n=o(parseFloat);else if("str"===s)n=o(String);else if("func"===s)n=o(function(t){return t?t:function(){}});else{if("arr"!==s&&"dom"!==s&&"raw"!=s)throw new Error("Unknown property type "+s);n=o()}"undefined"==typeof t["get_"+e]&&(t["get_"+e]=r),"undefined"==typeof t["set_"+e]&&("rw"===i?t["set_"+e]=n:"wo"===i&&(t["set_"+e]=function(t,i){if("undefined"!=typeof this["_"+e])throw new Error(e+" can only be set once");n.call(this,t,i)})),t["_raw_set_"+e]=function(t,e){n.call(this,t,e)}},Util.make_properties=function(t,e){"use strict";for(var i=0;i<e.length;i++)Util.make_property(t.prototype,e[i][0],e[i][1],e[i][2])},Util.set_defaults=function(t,e,i){var s,r=Object.keys(i),n=Object.keys(e),o={};for(s=0;s<r.length;s++)o[r[s]]=1;for(s=0;s<n.length;s++)o[n[s]]=1;var _=Object.keys(o);for(s=0;s<_.length;s++){var h=t["_raw_set_"+_[s]];h?_[s]in e?h.call(t,e[_[s]]):h.call(t,i[_[s]]):Util.Warn("Invalid property "+_[s])}},Util.decodeUTF8=function(t){"use strict";return decodeURIComponent(escape(t))},Util.get_include_uri=function(){return"undefined"!=typeof INCLUDE_URI?INCLUDE_URI:"include/"},Util._loading_scripts=[],Util._pending_scripts=[],Util.load_scripts=function(t){"use strict";for(var e,i=document.getElementsByTagName("head")[0],s=Util._loading_scripts,r=Util._pending_scripts,n=function(t){for(;s.length>0&&("loaded"===s[0].readyState||"complete"===s[0].readyState);){var e=s.shift();i.appendChild(e)}(!this.readyState||Util.Engine.presto&&"loaded"===this.readyState||"complete"===this.readyState)&&r.indexOf(this)>=0&&(this.onload=this.onreadystatechange=null,r.splice(r.indexOf(this),1),0===r.length&&window.onscriptsload&&window.onscriptsload())},o=0;o<t.length;o++)e=document.createElement("script"),e.type="text/javascript",e.src=Util.get_include_uri()+t[o],e.onload=e.onreadystatechange=n,Util.Engine.trident?s.push(e):(e.async=!1,i.appendChild(e)),r.push(e)},Util.getPosition=function(t){"use strict";var e=t.getBoundingClientRect();return{x:e.left+window.pageXOffset,y:e.top+window.pageYOffset,width:e.width,height:e.height}},Util.getEventPosition=function(t,e,i){"use strict";var s,r,n,o;s=t?t:window.event,s=s.changedTouches?s.changedTouches[0]:s.touches?s.touches[0]:s,s.pageX||s.pageY?(r=s.pageX,n=s.pageY):(s.clientX||s.clientY)&&(r=s.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=s.clientY+document.body.scrollTop+document.documentElement.scrollTop),o=Util.getPosition(e),"undefined"==typeof i&&(i=1);var _=r-o.x,h=n-o.y,a=Math.max(Math.min(_,o.width-1),0),c=Math.max(Math.min(h,o.height-1),0);return{x:a/i,y:c/i,realx:_/i,realy:h/i}},Util.addEvent=function(t,e,i){"use strict";if(t.attachEvent){var s=t.attachEvent("on"+e,i);return s}if(t.addEventListener)return t.addEventListener(e,i,!1),!0;throw new Error("Handler could not be attached")},Util.removeEvent=function(t,e,i){"use strict";if(t.detachEvent){var s=t.detachEvent("on"+e,i);return s}if(t.removeEventListener)return t.removeEventListener(e,i,!1),!0;throw new Error("Handler could not be removed")},Util.stopEvent=function(t){"use strict";t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault?t.preventDefault():t.returnValue=!1},Util._cursor_uris_supported=null,Util.browserSupportsCursorURIs=function(){if(null===Util._cursor_uris_supported)try{var t=document.createElement("canvas");t.style.cursor='url("data:image/x-icon;base64,AAACAAEACAgAAAIAAgA4AQAAFgAAACgAAAAIAAAAEAAAAAEAIAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAAAAAAAAAAA==") 2 2, default',t.style.cursor?(Util.Info("Data URI scheme cursor supported"),Util._cursor_uris_supported=!0):(Util.Warn("Data URI scheme cursor not supported"),Util._cursor_uris_supported=!1)}catch(e){Util.Error("Data URI scheme cursor test exception: "+e),Util._cursor_uris_supported=!1}return Util._cursor_uris_supported},Util.Features={xpath:!!document.evaluate,air:!!window.runtime,query:!!document.querySelector},function(){"use strict";var t=function(){return!!window.opera},e=function(){return!!window.ActiveXObject&&(window.XMLHttpRequest?document.querySelectorAll?6:5:4)},i=function(){try{return!navigator.taintEnabled&&(Util.Features.xpath?Util.Features.query?525:420:419)}catch(t){return!1}},s=function(t){var e=/WebKit\/([0-9\.]*) /,i=(navigator.userAgent.match(e)||["",t])[1];return parseFloat(i,10)},r=function(){return!(!document.getBoxObjectFor&&null==window.mozInnerScreenX)&&(document.getElementsByClassName?19:18)};Util.Engine={presto:t(),trident:e(),webkit:i(),gecko:r()},Util.Engine.webkit&&(Util.Engine.webkit=s(Util.Engine.webkit))}(),Util.Flash=function(){"use strict";var t,e;try{t=navigator.plugins["Shockwave Flash"].description}catch(i){try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(s){t="0 r0"}}return e=t.match(/\d+/g),{version:parseInt(e[0]||"0."+e[1],10)||0,build:parseInt(e[2],10)||0}}();var WebUtil={},$D;window.$D||(window.$D=function(t){return document.getElementById?document.getElementById(t):document.all?document.all[t]:document.layers?document.layers[t]:void 0}),WebUtil.init_logging=function(t){"use strict";if("undefined"!=typeof t)Util._log_level=t;else{var e=document.location.href.match(/logging=([A-Za-z0-9\._\-]*)/);Util._log_level=(e||["",Util._log_level])[1]}Util.init_logging()},WebUtil.dirObj=function(t,e,i){"use strict";e||(e=2),i||(i="");var s="";for(var r in t)if(e>1&&"object"==typeof t[r])s+=WebUtil.dirObj(t[r],e-1,i+"."+r);else{var n="";n="undefined"==typeof t[r]?"undefined":t[r].toString().replace("\n"," "),n.length>30&&(n=n.substr(0,30)+"..."),s+=i+"."+r+": "+n+"\n"}return s},WebUtil.getQueryVar=function(t,e){"use strict";var i=new RegExp(".*[?&]"+t+"=([^&#]*)"),s=document.location.href.match(i);return"undefined"==typeof e&&(e=null),s?decodeURIComponent(s[1]):e},WebUtil.getHashVar=function(t,e){"use strict";var i=new RegExp(".*[&#]"+t+"=([^&]*)"),s=document.location.hash.match(i);return"undefined"==typeof e&&(e=null),s?decodeURIComponent(s[1]):e},WebUtil.getConfigVar=function(t,e){"use strict";var i=WebUtil.getHashVar(t);return null===i&&(i=WebUtil.getQueryVar(t,e)),i},WebUtil.createCookie=function(t,e,i){"use strict";var s,r;i?(s=new Date,s.setTime(s.getTime()+24*i*60*60*1e3),r="; expires="+s.toGMTString()):r="";var n;n="https:"===document.location.protocol?"; secure":"",document.cookie=t+"="+e+r+"; path=/"+n},WebUtil.readCookie=function(t,e){"use strict";for(var i=t+"=",s=document.cookie.split(";"),r=0;r<s.length;r+=1){for(var n=s[r];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(i))return n.substring(i.length,n.length)}return"undefined"!=typeof e?e:null},WebUtil.eraseCookie=function(t){"use strict";WebUtil.createCookie(t,"",-1)},WebUtil.initSettings=function(t){"use strict";var e=Array.prototype.slice.call(arguments,1);window.chrome&&window.chrome.storage?window.chrome.storage.sync.get(function(i){WebUtil.settings=i,console.log(WebUtil.settings),t&&t.apply(this,e)}):t&&t.apply(this,e)},WebUtil.writeSetting=function(t,e){"use strict";window.chrome&&window.chrome.storage?WebUtil.settings[t]!==e&&(WebUtil.settings[t]=e,window.chrome.storage.sync.set(WebUtil.settings)):localStorage.setItem(t,e)},WebUtil.readSetting=function(t,e){"use strict";var i;return i=window.chrome&&window.chrome.storage?WebUtil.settings[t]:localStorage.getItem(t),"undefined"==typeof i&&(i=null),null===i&&void 0!==typeof e?e:i},WebUtil.eraseSetting=function(t){"use strict";window.chrome&&window.chrome.storage?(window.chrome.storage.sync.remove(t),delete WebUtil.settings[t]):localStorage.removeItem(t)},WebUtil.getStylesheets=function(){"use strict";for(var t=document.getElementsByTagName("link"),e=[],i=0;i<t.length;i+=1)t[i].title&&t[i].rel.toUpperCase().indexOf("STYLESHEET")>-1&&e.push(t[i]);return e},WebUtil.selectStylesheet=function(t){"use strict";"undefined"==typeof t&&(t="default");for(var e=WebUtil.getStylesheets(),i=0;i<e.length;i+=1){var s=e[i];s.title===t?(Util.Debug("Using stylesheet "+t),s.disabled=!1):s.disabled=!0}return t},WebUtil.injectParamIfMissing=function(t,e,i){t="/"+t;var s=document.createElement("a");s.href=t;var r,n=encodeURIComponent(e)+"=";return r=s.search?s.search.slice(1).split("&"):[],r.some(function(t){return t.startsWith(n)})||(r.push(n+encodeURIComponent(i)),s.search="?"+r.join("&")),"/"==s.pathname.charAt(0)?s.pathname.slice(1)+s.search+s.hash:s.pathname+s.search+s.hash};var Base64={toBase64Table:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),base64Pad:"=",encode:function(t){"use strict";for(var e="",i=Base64.toBase64Table,s=t.length,r=s%3,n=0;n<s-2;n+=3)e+=i[t[n]>>2],e+=i[((3&t[n])<<4)+(t[n+1]>>4)],e+=i[((15&t[n+1])<<2)+(t[n+2]>>6)],e+=i[63&t[n+2]];var o=0;return 2===r?(o=s-r,e+=i[t[o]>>2],e+=i[((3&t[o])<<4)+(t[o+1]>>4)],e+=i[(15&t[o+1])<<2],e+=i[64]):1===r&&(o=s-r,e+=i[t[o]>>2],e+=i[(3&t[o])<<4],e+=i[64],e+=i[64]),e},toBinaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode:function(t,e){"use strict";e="undefined"!=typeof e?e:0;var i,s,r=Base64.toBinaryTable,n=Base64.base64Pad,o=0,_=0,h=t.indexOf("=")-e;h<0&&(h=t.length-e),s=3*(h>>2)+Math.floor(h%4/1.5),i=new Array(s);for(var a=0,c=e;c<t.length;c++){var u=r[127&t.charCodeAt(c)],l=t.charAt(c)===n;u!==-1?(_=_<<6|u,o+=6,o>=8&&(o-=8,l||(i[a++]=_>>o&255),_&=(1<<o)-1)):console.error("Illegal character code "+t.charCodeAt(c)+" at position "+c)}if(o)throw err=new Error("Corrupted base64 string"),err.name="Base64-Error",err;return i}};window.WebSocket&&!window.WEB_SOCKET_FORCE_FLASH?Websock_native=!0:window.MozWebSocket&&!window.WEB_SOCKET_FORCE_FLASH?(Websock_native=!0,window.WebSocket=window.MozWebSocket):Websock_native=!1,function(){"use strict";var t=!1,e=41943040,i=function(){try{var t=new Uint8Array([1,2,3]);return String.fromCharCode.apply(null,t),function(t){return String.fromCharCode.apply(null,t)}}catch(e){return function(t){return String.fromCharCode.apply(null,Array.prototype.slice.call(t))}}}();Websock.prototype={get_sQ:function(){return this._sQ},get_rQ:function(){return this._rQ},get_rQi:function(){return this._rQi},set_rQi:function(t){this._rQi=t},rQlen:function(){return this._rQlen-this._rQi},rQpeek8:function(){return this._rQ[this._rQi]},rQshift8:function(){return this._rQ[this._rQi++]},rQskip8:function(){this._rQi++},rQskipBytes:function(t){this._rQi+=t},rQshift16:function(){return(this._rQ[this._rQi++]<<8)+this._rQ[this._rQi++]},rQshift32:function(){return(this._rQ[this._rQi++]<<24)+(this._rQ[this._rQi++]<<16)+(this._rQ[this._rQi++]<<8)+this._rQ[this._rQi++]},rQshiftStr:function(t){"undefined"==typeof t&&(t=this.rQlen());var e=new Uint8Array(this._rQ.buffer,this._rQi,t);return this._rQi+=t,i(e)},rQshiftBytes:function(t){return"undefined"==typeof t&&(t=this.rQlen()),this._rQi+=t,new Uint8Array(this._rQ.buffer,this._rQi-t,t)},rQshiftTo:function(t,e){void 0===e&&(e=this.rQlen()),t.set(new Uint8Array(this._rQ.buffer,this._rQi,e)),this._rQi+=e},rQwhole:function(){return new Uint8Array(this._rQ.buffer,0,this._rQlen)},rQslice:function(t,e){return e?new Uint8Array(this._rQ.buffer,this._rQi+t,e-t):new Uint8Array(this._rQ.buffer,this._rQi+t,this._rQlen-this._rQi-t)},rQwait:function(t,e,i){var s=this._rQlen-this._rQi;if(s<e){if(i){if(this._rQi<i)throw new Error("rQwait cannot backup "+i+" bytes");this._rQi-=i}return!0}return!1},flush:function(){return 0!==this._websocket.bufferedAmount&&Util.Debug("bufferedAmount: "+this._websocket.bufferedAmount),this._websocket.bufferedAmount<this.maxBufferedAmount?(this._sQlen>0&&this._websocket.readyState===WebSocket.OPEN&&(this._websocket.send(this._encode_message()),this._sQlen=0),!0):(Util.Info("Delaying send, bufferedAmount: "+this._websocket.bufferedAmount),!1)},send:function(t){return this._sQ.set(t,this._sQlen),this._sQlen+=t.length,this.flush()},send_string:function(t){this.send(t.split("").map(function(t){return t.charCodeAt(0)}))},off:function(t){this._eventHandlers[t]=function(){}},on:function(t,e){this._eventHandlers[t]=e},_allocate_buffers:function(){this._rQ=new Uint8Array(this._rQbufferSize),this._sQ=new Uint8Array(this._sQbufferSize)},init:function(t,e){this._allocate_buffers(),this._rQi=0,this._websocket=null;var i=!1;"Uint8Array"in window&&"set"in Uint8Array.prototype&&(i=!0);var s=!1;try{i&&("binaryType"in WebSocket.prototype||new WebSocket(e+"://.").binaryType)&&(Util.Info("Detected binaryType support in WebSockets"),s=!0)}catch(r){}if("undefined"==typeof t&&(t="binary"),Array.isArray(t)&&t.indexOf("binary")>-1&&(t="binary"),!s)throw new Error("noVNC no longer supports base64 WebSockets.  Please use a browser which supports binary WebSockets.");if("binary"!=t)throw new Error("noVNC no longer supports base64 WebSockets.  Please use the binary subprotocol instead.");return t},open:function(t,e){var i=t.match(/^([a-z]+):\/\//)[1];e=this.init(e,i),this._websocket=new WebSocket(t,e),e.indexOf("binary")>=0&&(this._websocket.binaryType="arraybuffer"),this._websocket.onmessage=this._recv_message.bind(this),this._websocket.onopen=function(){if(Util.Debug(">> WebSock.onopen"),this._websocket.protocol?(this._mode=this._websocket.protocol,Util.Info("Server choose sub-protocol: "+this._websocket.protocol)):(this._mode="binary",Util.Error("Server select no sub-protocol!: "+this._websocket.protocol)),"binary"!=this._mode)throw new Error("noVNC no longer supports base64 WebSockets.  Please use the binary subprotocol instead.");this._eventHandlers.open(),Util.Debug("<< WebSock.onopen")}.bind(this),this._websocket.onclose=function(t){Util.Debug(">> WebSock.onclose"),this._eventHandlers.close(t),Util.Debug("<< WebSock.onclose")}.bind(this),this._websocket.onerror=function(t){Util.Debug(">> WebSock.onerror: "+t),this._eventHandlers.error(t),Util.Debug("<< WebSock.onerror: "+t)}.bind(this)},close:function(){this._websocket&&(this._websocket.readyState!==WebSocket.OPEN&&this._websocket.readyState!==WebSocket.CONNECTING||(Util.Info("Closing WebSocket connection"),this._websocket.close()),this._websocket.onmessage=function(t){})},_encode_message:function(){return new Uint8Array(this._sQ.buffer,0,this._sQlen)},_expand_compact_rQ:function(i){var s=i||this._rQlen-this._rQi>this._rQbufferSize/2;if(s&&(i?this._rQbufferSize=8*(this._rQlen-this._rQi+i):this._rQbufferSize*=2),this._rQbufferSize>e&&(this._rQbufferSize=e,this._rQbufferSize-this._rQlen-this._rQi<i))throw new Exception("Receive Queue buffer exceeded "+e+" bytes, and the new message could not fit");if(s){var r=this._rQ.buffer;this._rQmax=this._rQbufferSize/8,this._rQ=new Uint8Array(this._rQbufferSize),this._rQ.set(new Uint8Array(r,this._rQi))}else t?this._rQ.copyWithin(0,this._rQi):this._rQ.set(new Uint8Array(this._rQ.buffer,this._rQi));this._rQlen=this._rQlen-this._rQi,this._rQi=0},_decode_message:function(t){var e=new Uint8Array(t);e.length>this._rQbufferSize-this._rQlen&&this._expand_compact_rQ(e.length),this._rQ.set(e,this._rQlen),this._rQlen+=e.length},_recv_message:function(t){try{this._decode_message(t.data),this.rQlen()>0?(this._eventHandlers.message(),this._rQlen==this._rQi?(this._rQlen=0,this._rQi=0):this._rQlen>this._rQmax&&this._expand_compact_rQ()):Util.Debug("Ignoring empty message")}catch(e){var i="";e.name&&(i+="\n    name: "+e.name+"\n",i+="    message: "+e.message+"\n"),"undefined"!=typeof e.description&&(i+="    description: "+e.description+"\n"),"undefined"!=typeof e.stack&&(i+=e.stack),i.length>0?Util.Error("recv_message, caught exception: "+i):Util.Error("recv_message, caught exception: "+e),"undefined"!=typeof e.name?this._eventHandlers.error(e.name+": "+e.message):this._eventHandlers.error(e)}}}}();var keysyms=function(){"use strict";function t(t){return t?{keysym:t,keyname:e?e[t]:t}:void 0}var e=null,i={32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,160:160,161:161,162:162,163:163,164:164,165:165,166:166,167:167,168:168,169:169,170:170,171:171,172:172,173:173,174:174,175:175,176:176,177:177,178:178,179:179,180:180,181:181,182:182,183:183,184:184,185:185,186:186,187:187,188:188,189:189,190:190,191:191,192:192,193:193,194:194,195:195,196:196,197:197,198:198,199:199,200:200,201:201,202:202,203:203,204:204,205:205,206:206,207:207,208:208,209:209,210:210,211:211,212:212,213:213,214:214,215:215,216:216,217:217,218:218,219:219,220:220,221:221,222:222,223:223,224:224,225:225,226:226,227:227,228:228,229:229,230:230,231:231,232:232,233:233,234:234,235:235,236:236,237:237,238:238,239:239,240:240,241:241,242:242,243:243,244:244,245:245,246:246,247:247,248:248,249:249,250:250,251:251,252:252,253:253,254:254,255:255,256:960,257:992,258:451,259:483,260:417,261:433,262:454,263:486,264:710,265:742,266:709,267:741,268:456,269:488,270:463,271:495,272:464,273:496,274:938,275:954,278:972,279:1004,280:458,281:490,282:460,283:492,284:728,285:760,286:683,287:699,288:725,289:757,290:939,291:955,292:678,293:694,294:673,295:689,296:933,297:949,298:975,299:1007,300:16777516,301:16777517,302:967,303:999,304:681,305:697,308:684,309:700,310:979,311:1011,312:930,313:453,314:485,315:934,316:950,317:421,318:437,321:419,322:435,323:465,324:497,325:977,326:1009,327:466,328:498,330:957,331:959,332:978,333:1010,336:469,337:501,338:5052,339:5053,340:448,341:480,342:931,343:947,344:472,345:504,346:422,347:438,348:734,349:766,350:426,351:442,352:425,353:441,354:478,355:510,356:427,357:443,358:940,359:956,360:989,361:1021,362:990,363:1022,364:733,365:765,366:473,367:505,368:475,369:507,370:985,371:1017,372:16777588,373:16777589,374:16777590,375:16777591,376:5054,377:428,378:444,379:431,380:447,381:430,382:446,399:16777615,402:2294,415:16777631,416:16777632,417:16777633,431:16777647,432:16777648,437:16777653,438:16777654,439:16777655,466:16777681,486:16777702,487:16777703,601:16777817,629:16777845,658:16777874,711:439,728:418,729:511,731:434,733:445,901:1966,902:1953,904:1954,905:1955,906:1956,908:1959,910:1960,911:1963,912:1974,913:1985,914:1986,915:1987,916:1988,917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2e3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,938:1957,939:1961,940:1969,941:1970,942:1971,943:1972,944:1978,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,962:2035,963:2034,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,970:1973,971:1977,972:1975,973:1976,974:1979,1025:1715,1026:1713,1027:1714,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1040:1761,1041:1762,1042:1783,1043:1767,1044:1764,1045:1765,1046:1782,1047:1786,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1056:1778,1057:1779,1058:1780,1059:1781,1060:1766,1061:1768,1062:1763,1063:1790,1064:1787,1065:1789,1066:1791,1067:1785,1068:1784,1069:1788,1070:1760,1071:1777,1072:1729,1073:1730,1074:1751,1075:1735,1076:1732,1077:1733,1078:1750,1079:1754,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1088:1746,1089:1747,1090:1748,1091:1749,1092:1734,1093:1736,1094:1731,1095:1758,1096:1755,1097:1757,1098:1759,1099:1753,1100:1752,1101:1756,1102:1728,1103:1745,1105:1699,1106:1697,1107:1698,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,1168:1725,1169:1709,1170:16778386,1171:16778387,1174:16778390,1175:16778391,1178:16778394,1179:16778395,1180:16778396,1181:16778397,1186:16778402,1187:16778403,1198:16778414,1199:16778415,1200:16778416,1201:16778417,1202:16778418,1203:16778419,1206:16778422,1207:16778423,1208:16778424,1209:16778425,1210:16778426,1211:16778427,1240:16778456,1241:16778457,1250:16778466,1251:16778467,1256:16778472,1257:16778473,1262:16778478,1263:16778479,1329:16778545,1330:16778546,1331:16778547,1332:16778548,1333:16778549,1334:16778550,1335:16778551,1336:16778552,1337:16778553,1338:16778554,1339:16778555,1340:16778556,1341:16778557,1342:16778558,1343:16778559,1344:16778560,1345:16778561,1346:16778562,1347:16778563,1348:16778564,1349:16778565,1350:16778566,1351:16778567,1352:16778568,1353:16778569,1354:16778570,1355:16778571,1356:16778572,1357:16778573,1358:16778574,1359:16778575,1360:16778576,1361:16778577,1362:16778578,1363:16778579,1364:16778580,1365:16778581,1366:16778582,1370:16778586,1371:16778587,1372:16778588,1373:16778589,1374:16778590,1377:16778593,1378:16778594,1379:16778595,1380:16778596,1381:16778597,1382:16778598,1383:16778599,1384:16778600,1385:16778601,1386:16778602,
1387:16778603,1388:16778604,1389:16778605,1390:16778606,1391:16778607,1392:16778608,1393:16778609,1394:16778610,1395:16778611,1396:16778612,1397:16778613,1398:16778614,1399:16778615,1400:16778616,1401:16778617,1402:16778618,1403:16778619,1404:16778620,1405:16778621,1406:16778622,1407:16778623,1408:16778624,1409:16778625,1410:16778626,1411:16778627,1412:16778628,1413:16778629,1414:16778630,1415:16778631,1417:16778633,1418:16778634,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,1619:16778835,1620:16778836,1621:16778837,1632:16778848,1633:16778849,1634:16778850,1635:16778851,1636:16778852,1637:16778853,1638:16778854,1639:16778855,1640:16778856,1641:16778857,1642:16778858,1648:16778864,1657:16778873,1662:16778878,1670:16778886,1672:16778888,1681:16778897,1688:16778904,1700:16778916,1705:16778921,1711:16778927,1722:16778938,1726:16778942,1729:16778945,1740:16778956,1746:16778962,1748:16778964,1776:16778992,1777:16778993,1778:16778994,1779:16778995,1780:16778996,1781:16778997,1782:16778998,1783:16778999,1784:16779e3,1785:16779001,3458:16780674,3459:16780675,3461:16780677,3462:16780678,3463:16780679,3464:16780680,3465:16780681,3466:16780682,3467:16780683,3468:16780684,3469:16780685,3470:16780686,3471:16780687,3472:16780688,3473:16780689,3474:16780690,3475:16780691,3476:16780692,3477:16780693,3478:16780694,3482:16780698,3483:16780699,3484:16780700,3485:16780701,3486:16780702,3487:16780703,3488:16780704,3489:16780705,3490:16780706,3491:16780707,3492:16780708,3493:16780709,3494:16780710,3495:16780711,3496:16780712,3497:16780713,3498:16780714,3499:16780715,3500:16780716,3501:16780717,3502:16780718,3503:16780719,3504:16780720,3505:16780721,3507:16780723,3508:16780724,3509:16780725,3510:16780726,3511:16780727,3512:16780728,3513:16780729,3514:16780730,3515:16780731,3517:16780733,3520:16780736,3521:16780737,3522:16780738,3523:16780739,3524:16780740,3525:16780741,3526:16780742,3530:16780746,3535:16780751,3536:16780752,3537:16780753,3538:16780754,3539:16780755,3540:16780756,3542:16780758,3544:16780760,3545:16780761,3546:16780762,3547:16780763,3548:16780764,3549:16780765,3550:16780766,3551:16780767,3570:16780786,3571:16780787,3572:16780788,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,4304:16781520,4305:16781521,4306:16781522,4307:16781523,4308:16781524,4309:16781525,4310:16781526,4311:16781527,4312:16781528,4313:16781529,4314:16781530,4315:16781531,4316:16781532,4317:16781533,4318:16781534,4319:16781535,4320:16781536,4321:16781537,4322:16781538,4323:16781539,4324:16781540,4325:16781541,4326:16781542,4327:16781543,4328:16781544,4329:16781545,4330:16781546,4331:16781547,4332:16781548,4333:16781549,4334:16781550,4335:16781551,4336:16781552,4337:16781553,4338:16781554,4339:16781555,4340:16781556,4341:16781557,4342:16781558,7682:16784898,7683:16784899,7690:16784906,7691:16784907,7710:16784926,7711:16784927,7734:16784950,7735:16784951,7744:16784960,7745:16784961,7766:16784982,7767:16784983,7776:16784992,7777:16784993,7786:16785002,7787:16785003,7808:16785024,7809:16785025,7810:16785026,7811:16785027,7812:16785028,7813:16785029,7818:16785034,7819:16785035,7840:16785056,7841:16785057,7842:16785058,7843:16785059,7844:16785060,7845:16785061,7846:16785062,7847:16785063,7848:16785064,7849:16785065,7850:16785066,7851:16785067,7852:16785068,7853:16785069,7854:16785070,7855:16785071,7856:16785072,7857:16785073,7858:16785074,7859:16785075,7860:16785076,7861:16785077,7862:16785078,7863:16785079,7864:16785080,7865:16785081,7866:16785082,7867:16785083,7868:16785084,7869:16785085,7870:16785086,7871:16785087,7872:16785088,7873:16785089,7874:16785090,7875:16785091,7876:16785092,7877:16785093,7878:16785094,7879:16785095,7880:16785096,7881:16785097,7882:16785098,7883:16785099,7884:16785100,7885:16785101,7886:16785102,7887:16785103,7888:16785104,7889:16785105,7890:16785106,7891:16785107,7892:16785108,7893:16785109,7894:16785110,7895:16785111,7896:16785112,7897:16785113,7898:16785114,7899:16785115,7900:16785116,7901:16785117,7902:16785118,7903:16785119,7904:16785120,7905:16785121,7906:16785122,7907:16785123,7908:16785124,7909:16785125,7910:16785126,7911:16785127,7912:16785128,7913:16785129,7914:16785130,7915:16785131,7916:16785132,7917:16785133,7918:16785134,7919:16785135,7920:16785136,7921:16785137,7922:16785138,7923:16785139,7924:16785140,7925:16785141,7926:16785142,7927:16785143,7928:16785144,7929:16785145,8194:2722,8195:2721,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8210:2747,8211:2730,8212:2729,8213:1967,8215:3295,8216:2768,8217:2769,8218:2813,8220:2770,8221:2771,8222:2814,8224:2801,8225:2802,8226:2790,8229:2735,8230:2734,8240:2773,8242:2774,8243:2775,8248:2812,8254:1150,8304:16785520,8308:16785524,8309:16785525,8310:16785526,8311:16785527,8312:16785528,8313:16785529,8320:16785536,8321:16785537,8322:16785538,8323:16785539,8324:16785540,8325:16785541,8326:16785542,8327:16785543,8328:16785544,8329:16785545,8352:16785568,8353:16785569,8354:16785570,8355:16785571,8356:16785572,8357:16785573,8358:16785574,8359:16785575,8360:16785576,8361:3839,8362:16785578,8363:16785579,8364:8364,8453:2744,8470:1712,8471:2811,8478:2772,8482:2761,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8539:2755,8540:2756,8541:2757,8542:2758,8592:2299,8593:2300,8594:2301,8595:2302,8658:2254,8660:2253,8706:2287,8709:16785925,8711:2245,8712:16785928,8713:16785929,8715:16785931,8728:3018,8730:2262,8731:16785947,8732:16785948,8733:2241,8734:2242,8743:2270,8744:2271,8745:2268,8746:2269,8747:2239,8748:16785964,8749:16785965,8756:2240,8757:16785973,8764:2248,8771:2249,8773:16785992,8775:16785991,8800:2237,8801:2255,8802:16786018,8803:16786019,8804:2236,8805:2238,8834:2266,8835:2267,8866:3068,8867:3036,8868:3010,8869:3022,8968:3027,8970:3012,8981:2810,8992:2212,8993:2213,9109:3020,9115:2219,9117:2220,9118:2221,9120:2222,9121:2215,9123:2216,9124:2217,9126:2218,9128:2223,9132:2224,9143:2209,9146:2543,9147:2544,9148:2546,9149:2547,9225:2530,9226:2533,9227:2537,9228:2531,9229:2532,9251:2732,9252:2536,9472:2211,9474:2214,9484:2210,9488:2539,9492:2541,9496:2538,9500:2548,9508:2549,9516:2551,9524:2550,9532:2542,9618:2529,9642:2791,9643:2785,9644:2779,9645:2786,9646:2783,9647:2767,9650:2792,9651:2787,9654:2781,9655:2765,9660:2793,9661:2788,9664:2780,9665:2764,9670:2528,9675:2766,9679:2782,9702:2784,9734:2789,9742:2809,9747:2762,9756:2794,9758:2795,9792:2808,9794:2807,9827:2796,9829:2798,9830:2797,9837:2806,9839:2805,10003:2803,10007:2804,10013:2777,10016:2800,10216:2748,10217:2750,10240:16787456,10241:16787457,10242:16787458,10243:16787459,10244:16787460,10245:16787461,10246:16787462,10247:16787463,10248:16787464,10249:16787465,10250:16787466,10251:16787467,10252:16787468,10253:16787469,10254:16787470,10255:16787471,10256:16787472,10257:16787473,10258:16787474,10259:16787475,10260:16787476,10261:16787477,10262:16787478,10263:16787479,10264:16787480,10265:16787481,10266:16787482,10267:16787483,10268:16787484,10269:16787485,10270:16787486,10271:16787487,10272:16787488,10273:16787489,10274:16787490,10275:16787491,10276:16787492,10277:16787493,10278:16787494,10279:16787495,10280:16787496,10281:16787497,10282:16787498,10283:16787499,10284:16787500,10285:16787501,10286:16787502,10287:16787503,10288:16787504,10289:16787505,10290:16787506,10291:16787507,10292:16787508,10293:16787509,10294:16787510,10295:16787511,10296:16787512,10297:16787513,10298:16787514,10299:16787515,10300:16787516,10301:16787517,10302:16787518,10303:16787519,10304:16787520,10305:16787521,10306:16787522,10307:16787523,10308:16787524,10309:16787525,10310:16787526,10311:16787527,10312:16787528,10313:16787529,10314:16787530,10315:16787531,10316:16787532,10317:16787533,10318:16787534,10319:16787535,10320:16787536,10321:16787537,10322:16787538,10323:16787539,10324:16787540,10325:16787541,10326:16787542,10327:16787543,10328:16787544,10329:16787545,10330:16787546,10331:16787547,10332:16787548,10333:16787549,10334:16787550,10335:16787551,10336:16787552,10337:16787553,10338:16787554,10339:16787555,10340:16787556,10341:16787557,10342:16787558,10343:16787559,10344:16787560,10345:16787561,10346:16787562,10347:16787563,10348:16787564,10349:16787565,10350:16787566,10351:16787567,10352:16787568,10353:16787569,10354:16787570,10355:16787571,10356:16787572,10357:16787573,10358:16787574,10359:16787575,10360:16787576,10361:16787577,10362:16787578,10363:16787579,10364:16787580,10365:16787581,10366:16787582,10367:16787583,10368:16787584,10369:16787585,10370:16787586,10371:16787587,10372:16787588,10373:16787589,10374:16787590,10375:16787591,10376:16787592,10377:16787593,10378:16787594,10379:16787595,10380:16787596,10381:16787597,10382:16787598,10383:16787599,10384:16787600,10385:16787601,10386:16787602,10387:16787603,10388:16787604,10389:16787605,10390:16787606,10391:16787607,10392:16787608,10393:16787609,10394:16787610,10395:16787611,10396:16787612,10397:16787613,10398:16787614,10399:16787615,10400:16787616,10401:16787617,10402:16787618,10403:16787619,10404:16787620,10405:16787621,10406:16787622,10407:16787623,10408:16787624,10409:16787625,10410:16787626,10411:16787627,10412:16787628,10413:16787629,10414:16787630,10415:16787631,10416:16787632,10417:16787633,10418:16787634,10419:16787635,10420:16787636,10421:16787637,10422:16787638,10423:16787639,10424:16787640,10425:16787641,10426:16787642,10427:16787643,10428:16787644,10429:16787645,10430:16787646,10431:16787647,10432:16787648,10433:16787649,10434:16787650,10435:16787651,10436:16787652,10437:16787653,10438:16787654,10439:16787655,10440:16787656,10441:16787657,10442:16787658,10443:16787659,10444:16787660,10445:16787661,10446:16787662,10447:16787663,10448:16787664,10449:16787665,10450:16787666,10451:16787667,10452:16787668,10453:16787669,10454:16787670,10455:16787671,10456:16787672,10457:16787673,10458:16787674,10459:16787675,10460:16787676,10461:16787677,10462:16787678,10463:16787679,10464:16787680,10465:16787681,10466:16787682,10467:16787683,10468:16787684,10469:16787685,10470:16787686,10471:16787687,10472:16787688,10473:16787689,10474:16787690,10475:16787691,10476:16787692,10477:16787693,10478:16787694,10479:16787695,10480:16787696,10481:16787697,10482:16787698,10483:16787699,10484:16787700,10485:16787701,10486:16787702,10487:16787703,10488:16787704,10489:16787705,10490:16787706,10491:16787707,10492:16787708,10493:16787709,10494:16787710,10495:16787711,12289:1188,12290:1185,12300:1186,12301:1187,12443:1246,12444:1247,12449:1191,12450:1201,12451:1192,12452:1202,12453:1193,12454:1203,12455:1194,12456:1204,12457:1195,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12483:1199,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12515:1196,12516:1236,12517:1197,12518:1237,12519:1198,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12530:1190,12531:1245,12539:1189,12540:1200};return{fromUnicode:function(e){return t(i[e])},lookup:t}}(),kbdUtil=function(){"use strict";function t(t){var e={536:350,537:351,538:354,539:355},i=e[t];return i?i:t}function e(){return navigator&&!!/mac/i.exec(navigator.platform)}function i(){return navigator&&!!/win/i.exec(navigator.platform)}function s(){return navigator&&!!/linux/i.exec(navigator.platform)}function r(t,e){var i={};for(var s in e)parseInt(s)!==XK_Shift_L&&(i[s]=e[s]);var r=0;for(var o in e)i[o]&&++r;return n(t,i)?r>t.length:r>0}function n(t,e){if(0===t.length)return!1;for(var i=0;i<t.length;++i)if(!e[t[i]])return!1;return!0}function o(t){function o(t,e){function i(t){return{keysym:keysyms.lookup(t),type:a[t]?"keydown":"keyup"}}var s=[];return void 0!==t.ctrlKey&&t.ctrlKey!==a[XK_Control_L]&&e!==XK_Control_L&&(a[XK_Control_L]=t.ctrlKey,s.push(i(XK_Control_L))),void 0!==t.altKey&&t.altKey!==a[XK_Alt_L]&&e!==XK_Alt_L&&(a[XK_Alt_L]=t.altKey,s.push(i(XK_Alt_L))),void 0!==t.altGraphKey&&t.altGraphKey!==a[XK_ISO_Level3_Shift]&&e!==XK_ISO_Level3_Shift&&(a[XK_ISO_Level3_Shift]=t.altGraphKey,s.push(i(XK_ISO_Level3_Shift))),void 0!==t.shiftKey&&t.shiftKey!==a[XK_Shift_L]&&e!==XK_Shift_L&&(a[XK_Shift_L]=t.shiftKey,s.push(i(XK_Shift_L))),void 0!==t.metaKey&&t.metaKey!==a[XK_Meta_L]&&e!==XK_Meta_L&&(a[XK_Meta_L]=t.metaKey,s.push(i(XK_Meta_L))),s}function _(t,e){var i=h(t),s=i?i.keysym:null;return null!==s&&void 0!==a[s]&&(a[s]=e),o(t,s)}t||(t=e()?[XK_Alt_L]:i()?[XK_Alt_L,XK_Control_L]:s()?[XK_ISO_Level3_Shift]:[]);var a={};return a[XK_Control_L]=!1,a[XK_Alt_L]=!1,a[XK_ISO_Level3_Shift]=!1,a[XK_Shift_L]=!1,a[XK_Meta_L]=!1,{keydown:function(t){return _(t,!0)},keyup:function(t){return _(t,!1)},syncAny:function(t){return o(t)},hasShortcutModifier:function(){return r(t,a)},activeCharModifier:function(){return n(t,a)?t:null}}}function _(t){return"keyCode"in t&&"key"in t?t.key+":"+t.keyCode:"keyCode"in t?t.keyCode:t.key}function h(e){var i;if(e["char"]&&1===e["char"].length?i=e["char"].charCodeAt():e.charCode?i=e.charCode:e.keyCode&&"keypress"===e.type&&(i=e.keyCode),i){var s=keysyms.fromUnicode(t(i));if(s)return s}return e.keyCode?keysyms.lookup(a(e.keyCode,e.shiftKey)):e.which?keysyms.lookup(a(e.which,e.shiftKey)):null}function a(t,e){if("number"!=typeof t)return null;if(t>=48&&t<=57)return t;if(t>=65&&t<=90)return e?t:t+32;if(t>=96&&t<=105)return XK_KP_0+(t-96);switch(t){case 32:return XK_space;case 106:return XK_KP_Multiply;case 107:return XK_KP_Add;case 108:return XK_KP_Separator;case 109:return XK_KP_Subtract;case 110:return XK_KP_Decimal;case 111:return XK_KP_Divide;case 187:return XK_plus;case 188:return XK_comma;case 189:return XK_minus;case 190:return XK_period}return c({keyCode:t})}function c(t){if(!t.keyCode)return null;var e=t.keyCode;if(e>=112&&e<=135)return XK_F1+e-112;switch(e){case 8:return XK_BackSpace;case 13:return XK_Return;case 9:return XK_Tab;case 27:return XK_Escape;case 46:return XK_Delete;case 36:return XK_Home;case 35:return XK_End;case 33:return XK_Page_Up;case 34:return XK_Page_Down;case 45:return XK_Insert;case 37:return XK_Left;case 38:return XK_Up;case 39:return XK_Right;case 40:return XK_Down;case 16:return XK_Shift_L;case 17:return XK_Control_L;case 18:return XK_Alt_L;case 224:return XK_Meta_L;case 225:return XK_ISO_Level3_Shift;case 91:return XK_Super_L;case 92:return XK_Super_R;case 93:return XK_Menu;default:return null}}return{hasShortcutModifier:r,hasCharModifier:n,ModifierSync:o,getKey:_,getKeysym:h,keysymFromKeyCode:a,nonCharacterKey:c,substituteCodepoint:t}}(),Keyboard,Mouse;!function(){"use strict";Keyboard=function(t){this._keyDownList=[],Util.set_defaults(this,t,{target:document,focused:!0}),this._handler=new KeyEventDecoder(kbdUtil.ModifierSync(),VerifyCharModifier(TrackKeyState(EscapeModifiers(this._handleRfbEvent.bind(this))))),this._eventHandlers={keyup:this._handleKeyUp.bind(this),keydown:this._handleKeyDown.bind(this),keypress:this._handleKeyPress.bind(this),blur:this._allKeysUp.bind(this)}},Keyboard.prototype={_handleRfbEvent:function(t){this._onKeyPress&&(Util.Debug("onKeyPress "+("keydown"==t.type?"down":"up")+", keysym: "+t.keysym.keysym+"("+t.keysym.keyname+")"),this._onKeyPress(t.keysym.keysym,"keydown"==t.type))},_handleKeyDown:function(t){return!this._focused||(!this._handler.keydown(t)||(Util.stopEvent(t),!1))},_handleKeyPress:function(t){return!this._focused||(!this._handler.keypress(t)||(Util.stopEvent(t),!1))},_handleKeyUp:function(t){return!this._focused||(!this._handler.keyup(t)||(Util.stopEvent(t),!1))},_allKeysUp:function(){Util.Debug(">> Keyboard.allKeysUp"),this._handler.releaseAll(),Util.Debug("<< Keyboard.allKeysUp")},grab:function(){var t=this._target;Util.addEvent(t,"keydown",this._eventHandlers.keydown),Util.addEvent(t,"keyup",this._eventHandlers.keyup),Util.addEvent(t,"keypress",this._eventHandlers.keypress),Util.addEvent(window,"blur",this._eventHandlers.blur)},ungrab:function(){var t=this._target;Util.removeEvent(t,"keydown",this._eventHandlers.keydown),Util.removeEvent(t,"keyup",this._eventHandlers.keyup),Util.removeEvent(t,"keypress",this._eventHandlers.keypress),Util.removeEvent(window,"blur",this._eventHandlers.blur),this._allKeysUp()},sync:function(t){this._handler.syncModifiers(t)}},Util.make_properties(Keyboard,[["target","wo","dom"],["focused","rw","bool"],["onKeyPress","rw","func"]]),Mouse=function(t){this._mouseCaptured=!1,this._doubleClickTimer=null,this._lastTouchPos=null,Util.set_defaults(this,t,{target:document,focused:!0,scale:1,touchButton:1}),this._eventHandlers={mousedown:this._handleMouseDown.bind(this),mouseup:this._handleMouseUp.bind(this),mousemove:this._handleMouseMove.bind(this),mousewheel:this._handleMouseWheel.bind(this),mousedisable:this._handleMouseDisable.bind(this)}},Mouse.prototype={_captureMouse:function(){this._target.setCapture&&this._target.setCapture(),this._mouseCaptured=!0},_releaseMouse:function(){this._target.releaseCapture&&this._target.releaseCapture(),this._mouseCaptured=!1},_resetDoubleClickTimer:function(){this._doubleClickTimer=null},_handleMouseButton:function(t,e){if(!this._focused)return!0;this._notify&&this._notify(t);var i,s=t?t:window.event,r=Util.getEventPosition(t,this._target,this._scale);if(t.touches||t.changedTouches){if(1==e){if(null===this._doubleClickTimer)this._lastTouchPos=r;else{clearTimeout(this._doubleClickTimer);var n=this._lastTouchPos.x-r.x,o=this._lastTouchPos.y-r.y,_=Math.sqrt(n*n+o*o),h=20*(window.devicePixelRatio||1);_<h&&(r=this._lastTouchPos)}this._doubleClickTimer=setTimeout(this._resetDoubleClickTimer.bind(this),500)}i=this._touchButton}else i=s.which?1<<s.button:(1&s.button)+2*(2&s.button)+(4&s.button)/2;return this._onMouseButton&&(Util.Debug("onMouseButton "+(e?"down":"up")+", x: "+r.x+", y: "+r.y+", bmask: "+i),this._onMouseButton(r.x,r.y,e,i)),Util.stopEvent(t),!1},_handleMouseDown:function(t){this._captureMouse(),this._handleMouseButton(t,1)},_handleMouseUp:function(t){this._mouseCaptured&&(this._handleMouseButton(t,0),this._releaseMouse())},_handleMouseWheel:function(t){if(!this._focused)return!0;this._notify&&this._notify(t);var e,i=t?t:window.event,s=Util.getEventPosition(t,this._target,this._scale),r=i.detail?i.detail*-1:i.wheelDelta/40;return e=r>0?8:16,this._onMouseButton&&(this._onMouseButton(s.x,s.y,1,e),this._onMouseButton(s.x,s.y,0,e)),Util.stopEvent(t),!1},_handleMouseMove:function(t){if(!this._focused)return!0;this._notify&&this._notify(t);var e=(t?t:window.event,Util.getEventPosition(t,this._target,this._scale));return this._onMouseMove&&this._onMouseMove(e.x,e.y),Util.stopEvent(t),!1},_handleMouseDisable:function(t){if(!this._focused)return!0;var e=(t?t:window.event,Util.getEventPosition(t,this._target,this._scale));return!(e.realx>=0&&e.realy>=0&&e.realx<this._target.offsetWidth&&e.realy<this._target.offsetHeight)||(Util.stopEvent(t),!1)},grab:function(){var t=this._target;"ontouchstart"in document.documentElement&&(Util.addEvent(t,"touchstart",this._eventHandlers.mousedown),Util.addEvent(window,"touchend",this._eventHandlers.mouseup),Util.addEvent(t,"touchend",this._eventHandlers.mouseup),Util.addEvent(t,"touchmove",this._eventHandlers.mousemove)),Util.addEvent(t,"mousedown",this._eventHandlers.mousedown),Util.addEvent(window,"mouseup",this._eventHandlers.mouseup),Util.addEvent(t,"mouseup",this._eventHandlers.mouseup),Util.addEvent(t,"mousemove",this._eventHandlers.mousemove),Util.addEvent(t,Util.Engine.gecko?"DOMMouseScroll":"mousewheel",this._eventHandlers.mousewheel),Util.addEvent(document,"click",this._eventHandlers.mousedisable),Util.addEvent(document.body,"contextmenu",this._eventHandlers.mousedisable)},ungrab:function(){var t=this._target;"ontouchstart"in document.documentElement&&(Util.removeEvent(t,"touchstart",this._eventHandlers.mousedown),Util.removeEvent(window,"touchend",this._eventHandlers.mouseup),Util.removeEvent(t,"touchend",this._eventHandlers.mouseup),Util.removeEvent(t,"touchmove",this._eventHandlers.mousemove)),Util.removeEvent(t,"mousedown",this._eventHandlers.mousedown),Util.removeEvent(window,"mouseup",this._eventHandlers.mouseup),Util.removeEvent(t,"mouseup",this._eventHandlers.mouseup),Util.removeEvent(t,"mousemove",this._eventHandlers.mousemove),Util.removeEvent(t,Util.Engine.gecko?"DOMMouseScroll":"mousewheel",this._eventHandlers.mousewheel),Util.removeEvent(document,"click",this._eventHandlers.mousedisable),Util.removeEvent(document.body,"contextmenu",this._eventHandlers.mousedisable)}},Util.make_properties(Mouse,[["target","ro","dom"],["notify","ro","func"],["focused","rw","bool"],["scale","rw","float"],["onMouseButton","rw","func"],["onMouseMove","rw","func"],["touchButton","rw","int"]])}();var Display;!function(){"use strict";var t=!1;try{new ImageData(new Uint8ClampedArray(1),1,1),t=!0}catch(e){}Display=function(t){if(this._drawCtx=null,this._c_forceCanvas=!1,this._renderQ=[],this._fb_width=0,this._fb_height=0,this._maxWidth=0,this._maxHeight=0,this._viewportLoc={x:0,y:0,w:0,h:0},this._cleanRect={x1:0,y1:0,x2:-1,y2:-1},this._prevDrawStyle="",this._tile=null,this._tile16x16=null,this._tile_x=0,this._tile_y=0,Util.set_defaults(this,t,{true_color:!0,colourMap:[],scale:1,viewport:!1,render_mode:""}),Util.Debug(">> Display.constructor"),!this._target)throw new Error("Target must be set");if("string"==typeof this._target)throw new Error("target must be a DOM element");if(!this._target.getContext)throw new Error("no getContext method");if(this._drawCtx||(this._drawCtx=this._target.getContext("2d")),Util.Debug("User Agent: "+navigator.userAgent),Util.Engine.gecko&&Util.Debug("Browser: gecko "+Util.Engine.gecko),Util.Engine.webkit&&Util.Debug("Browser: webkit "+Util.Engine.webkit),Util.Engine.trident&&Util.Debug("Browser: trident "+Util.Engine.trident),Util.Engine.presto&&Util.Debug("Browser: presto "+Util.Engine.presto),this.clear(),!("createImageData"in this._drawCtx))throw new Error("Canvas does not support createImageData");this._render_mode="canvas rendering",null===this._prefer_js&&(Util.Info("Prefering javascript operations"),this._prefer_js=!0),(this._cursor_uri||null===this._cursor_uri||void 0===this._cursor_uri)&&(this._cursor_uri=Util.browserSupportsCursorURIs()),Util.Debug("<< Display.constructor")},Display.prototype={viewportChangePos:function(t,e){var i=this._viewportLoc;t=Math.floor(t),e=Math.floor(e),this._viewport||(t=-i.w,e=-i.h);var s=i.x+i.w-1,r=i.y+i.h-1;if(t<0&&i.x+t<0&&(t=-i.x),s+t>=this._fb_width&&(t-=s+t-this._fb_width+1),i.y+e<0&&(e=-i.y),r+e>=this._fb_height&&(e-=r+e-this._fb_height+1),0!==t||0!==e){Util.Debug("viewportChange deltaX: "+t+", deltaY: "+e),i.x+=t,s+=t,i.y+=e,r+=e;var n=this._cleanRect;i.x>n.x1&&(n.x1=i.x),s<n.x2&&(n.x2=s),i.y>n.y1&&(n.y1=i.y),r<n.y2&&(n.y2=r);var o,_;t<0?(o=0,_=-t):(o=i.w-t,_=t);var h,a;e<0?(h=0,a=-e):(h=i.h-e,a=e);var c=this._drawCtx.fillStyle,u=this._target;this._drawCtx.fillStyle="rgb(255,255,255)",this._drawCtx.mozImageSmoothingEnabled?this._drawCtx.mozImageSmoothingEnabled=!1:this._drawCtx.webkitImageSmoothingEnabled?this._drawCtx.webkitImageSmoothingEnabled=!1:this._drawCtx.msImageSmoothingEnabled?this._drawCtx.msImageSmoothingEnabled=!1:this._drawCtx.imageSmoothingEnabled&&(this._drawCtx.imageSmoothingEnabled=!1),this._drawCtx.drawImage(u,0,0,i.w,i.h,-t,-e,i.w,i.h),0!==t&&this._drawCtx.fillRect(o,0,_,i.h),0!==e&&this._drawCtx.fillRect(0,h,i.w,a),this._drawCtx.fillStyle=c}},viewportChangeSize:function(t,e){"undefined"!=typeof t&&"undefined"!=typeof e||(Util.Debug("Setting viewport to full display region"),t=this._fb_width,e=this._fb_height);var i=this._viewportLoc;if(i.w!==t||i.h!==e){this._viewport&&(0!==this._maxWidth&&t>this._maxWidth&&(t=this._maxWidth),0!==this._maxHeight&&e>this._maxHeight&&(e=this._maxHeight));var s=this._cleanRect;t<i.w&&s.x2>i.x+t-1&&(s.x2=i.x+t-1),e<i.h&&s.y2>i.y+e-1&&(s.y2=i.y+e-1),i.w=t,i.h=e;var r=this._target;if(r.width!==t||r.height!==e){var n=null;if(i.w>0&&i.h>0&&r.width>0&&r.height>0){var o=r.width<i.w?r.width:i.w,_=r.height<i.h?r.height:i.h;n=this._drawCtx.getImageData(0,0,o,_)}r.width!==t&&(r.width=t,r.style.width=t+"px"),r.height!==e&&(r.height=e,r.style.height=e+"px"),n&&this._drawCtx.putImageData(n,0,0)}}},getCleanDirtyReset:function(){var t=this._viewportLoc,e=this._cleanRect,i={x:e.x1,y:e.y1,w:e.x2-e.x1+1,h:e.y2-e.y1+1},s=[];if(e.x1>=e.x2||e.y1>=e.y2)s.push({x:t.x,y:t.y,w:t.w,h:t.h});else{var r=t.x+t.w-1,n=t.y+t.h-1;t.x<e.x1&&s.push({x:t.x,y:t.y,w:e.x1-t.x+1,h:t.h}),r>e.x2&&s.push({x:e.x2+1,y:t.y,w:r-e.x2,h:t.h}),t.y<e.y1&&s.push({x:e.x1,y:t.y,w:e.x2-e.x1+1,h:e.y1-t.y}),n>e.y2&&s.push({x:e.x1,y:e.y2+1,w:e.x2-e.x1+1,h:n-e.y2})}return this._cleanRect={x1:t.x,y1:t.y,x2:t.x+t.w-1,y2:t.y+t.h-1},{cleanBox:i,dirtyBoxes:s}},absX:function(t){return t+this._viewportLoc.x},absY:function(t){return t+this._viewportLoc.y},resize:function(t,e){this._prevDrawStyle="",this._fb_width=t,this._fb_height=e,this._rescale(this._scale),this.viewportChangeSize()},clear:function(){this._logo?(this.resize(this._logo.width,this._logo.height),this.blitStringImage(this._logo.data,0,0)):(6===Util.Engine.trident&&this._drawCtx.clearRect(0,0,this._viewportLoc.w,this._viewportLoc.h),this.resize(240,20),this._drawCtx.clearRect(0,0,this._viewportLoc.w,this._viewportLoc.h)),this._renderQ=[]},fillRect:function(t,e,i,s,r,n){0===this._renderQ.length||n?(this._setFillColor(r),this._drawCtx.fillRect(t-this._viewportLoc.x,e-this._viewportLoc.y,i,s)):this.renderQ_push({type:"fill",x:t,y:e,width:i,height:s,color:r})},copyImage:function(t,e,i,s,r,n,o){if(0===this._renderQ.length||o){var _=t-this._viewportLoc.x,h=e-this._viewportLoc.y,a=i-this._viewportLoc.x,c=s-this._viewportLoc.y;this._drawCtx.drawImage(this._target,_,h,r,n,a,c,r,n)}else this.renderQ_push({type:"copy",old_x:t,old_y:e,x:i,y:s,width:r,height:n})},startTile:function(t,e,i,s,r){if(this._tile_x=t,this._tile_y=e,16===i&&16===s?this._tile=this._tile16x16:this._tile=this._drawCtx.createImageData(i,s),this._prefer_js){var n;n=this._true_color?r:this._colourMap[r[0]];for(var o=n[2],_=n[1],h=n[0],a=this._tile.data,c=0;c<i*s*4;c+=4)a[c]=o,a[c+1]=_,a[c+2]=h,a[c+3]=255}else this.fillRect(t,e,i,s,r,!0)},subTile:function(t,e,i,s,r){if(this._prefer_js){var n;n=this._true_color?r:this._colourMap[r[0]];for(var o=n[2],_=n[1],h=n[0],a=t+i,c=e+s,u=this._tile.data,l=this._tile.width,d=e;d<c;d++)for(var f=t;f<a;f++){var p=4*(f+d*l);u[p]=o,u[p+1]=_,u[p+2]=h,u[p+3]=255}}else this.fillRect(this._tile_x+t,this._tile_y+e,i,s,r,!0)},finishTile:function(){this._prefer_js&&this._drawCtx.putImageData(this._tile,this._tile_x-this._viewportLoc.x,this._tile_y-this._viewportLoc.y)},blitImage:function(t,e,i,s,r,n,o){if(0===this._renderQ.length||o)this._true_color?this._bgrxImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,i,s,r,n):this._cmapImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,i,s,r,n);else{var _=new Uint8Array(i*s*4);_.set(new Uint8Array(r.buffer,0,_.length)),this.renderQ_push({type:"blit",data:_,x:t,y:e,width:i,height:s})}},blitRgbImage:function(t,e,i,s,r,n,o){if(0===this._renderQ.length||o)this._true_color?this._rgbImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,i,s,r,n):this._cmapImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,i,s,r,n);else{var _=new Uint8Array(i*s*4);_.set(new Uint8Array(r.buffer,0,_.length)),this.renderQ_push({type:"blitRgb",data:_,x:t,y:e,width:i,height:s})}},blitRgbxImage:function(t,e,i,s,r,n,o){if(0===this._renderQ.length||o)this._rgbxImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,i,s,r,n);else{var _=new Uint8Array(i*s*4);_.set(new Uint8Array(r.buffer,0,_.length)),this.renderQ_push({type:"blitRgbx",data:_,x:t,y:e,width:i,height:s})}},blitStringImage:function(t,e,i){var s=new Image;return s.onload=function(){this._drawCtx.drawImage(s,e-this._viewportLoc.x,i-this._viewportLoc.y)}.bind(this),s.src=t,s},drawImage:function(t,e,i){this._drawCtx.drawImage(t,e-this._viewportLoc.x,i-this._viewportLoc.y)},renderQ_push:function(t){this._renderQ.push(t),1===this._renderQ.length&&this._scan_renderQ()},changeCursor:function(t,e,i,s,r,n){return this._cursor_uri===!1?void Util.Warn("changeCursor called but no cursor data URI support"):void(this._true_color?Display.changeCursor(this._target,t,e,i,s,r,n):Display.changeCursor(this._target,t,e,i,s,r,n,this._colourMap))},defaultCursor:function(){this._target.style.cursor="default"},disableLocalCursor:function(){this._target.style.cursor="none"},clippingDisplay:function(){var t=this._viewportLoc,e=this._fb_width>t.w||this._fb_height>t.h,i=0!==this._maxWidth&&0!==this._maxHeight,s=!1;return i&&(s=t.w>this._maxWidth||t.h>this._maxHeight),e||i&&s},get_context:function(){return this._drawCtx},set_scale:function(t){this._rescale(t)},set_width:function(t){this._fb_width=t},get_width:function(){return this._fb_width},set_height:function(t){this._fb_height=t},get_height:function(){return this._fb_height},autoscale:function(t,e,i){var s,r=t/e,n=this._fb_width/this._fb_height;s=n>=r?t/this._fb_width:e/this._fb_height;var o,_;return s>1&&i?(o=this._fb_width,_=this._fb_height,s=1):n>=r?(o=t,_=Math.round(t/n)):(o=Math.round(e*n),_=e),this._target.style.width=o+"px",this._target.style.height=_+"px",this._scale=s,s},_rescale:function(t){this._scale=t;var e,i;this._viewport&&0!==this._maxWidth&&0!==this._maxHeight?(e=Math.min(this._fb_width,this._maxWidth),i=Math.min(this._fb_height,this._maxHeight)):(e=this._fb_width,i=this._fb_height),this._target.style.width=Math.round(t*e)+"px",this._target.style.height=Math.round(t*i)+"px"},_setFillColor:function(t){var e;e=this._true_color?t:this._colourMap[t];var i="rgb("+e[2]+","+e[1]+","+e[0]+")";i!==this._prevDrawStyle&&(this._drawCtx.fillStyle=i,this._prevDrawStyle=i)},_rgbImageData:function(t,e,i,s,r,n,o,_){for(var h=this._drawCtx.createImageData(r,n),a=h.data,c=0,u=_;c<r*n*4;c+=4,u+=3)a[c]=o[u],a[c+1]=o[u+1],a[c+2]=o[u+2],a[c+3]=255;this._drawCtx.putImageData(h,t-i,e-s)},_bgrxImageData:function(t,e,i,s,r,n,o,_){for(var h=this._drawCtx.createImageData(r,n),a=h.data,c=0,u=_;c<r*n*4;c+=4,u+=4)a[c]=o[u+2],a[c+1]=o[u+1],a[c+2]=o[u],a[c+3]=255;this._drawCtx.putImageData(h,t-i,e-s)},_rgbxImageData:function(e,i,s,r,n,o,_,h){var a;t?a=new ImageData(new Uint8ClampedArray(_.buffer,_.byteOffset,n*o*4),n,o):(a=this._drawCtx.createImageData(n,o),a.data.set(new Uint8ClampedArray(_.buffer,_.byteOffset,n*o*4))),this._drawCtx.putImageData(a,e-s,i-r)},_cmapImageData:function(t,e,i,s,r,n,o,_){for(var h=this._drawCtx.createImageData(r,n),a=h.data,c=this._colourMap,u=0,l=_;u<r*n*4;u+=4,l++){var d=c[o[l]];a[u]=d[2],a[u+1]=d[1],a[u+2]=d[0],a[u+3]=255}this._drawCtx.putImageData(h,t-i,e-s)},_scan_renderQ:function(){
for(var t=!0;t&&this._renderQ.length>0;){var e=this._renderQ[0];switch(e.type){case"copy":this.copyImage(e.old_x,e.old_y,e.x,e.y,e.width,e.height,!0);break;case"fill":this.fillRect(e.x,e.y,e.width,e.height,e.color,!0);break;case"blit":this.blitImage(e.x,e.y,e.width,e.height,e.data,0,!0);break;case"blitRgb":this.blitRgbImage(e.x,e.y,e.width,e.height,e.data,0,!0);break;case"blitRgbx":this.blitRgbxImage(e.x,e.y,e.width,e.height,e.data,0,!0);break;case"img":e.img.complete?this.drawImage(e.img,e.x,e.y):t=!1}t&&this._renderQ.shift()}this._renderQ.length>0&&requestAnimFrame(this._scan_renderQ.bind(this))}},Util.make_properties(Display,[["target","wo","dom"],["context","ro","raw"],["logo","rw","raw"],["true_color","rw","bool"],["colourMap","rw","arr"],["scale","rw","float"],["viewport","rw","bool"],["width","rw","int"],["height","rw","int"],["maxWidth","rw","int"],["maxHeight","rw","int"],["render_mode","ro","str"],["prefer_js","rw","str"],["cursor_uri","rw","raw"]]),Display.changeCursor=function(t,e,i,s,r,n,o,_){var h=n,a=o;a<h?a=h:h=a;var c=[];c.push16le=function(t){this.push(255&t,t>>8&255)},c.push32le=function(t){this.push(255&t,t>>8&255,t>>16&255,t>>24&255)};var u=40,l=h*a*4,d=Math.ceil(h*a/8),f=Math.ceil(h*a/8);c.push16le(0),c.push16le(2),c.push16le(1),c.push(h),c.push(a),c.push(0),c.push(0),c.push16le(s),c.push16le(r),c.push32le(u+l+d+f),c.push32le(22),c.push32le(u),c.push32le(h),c.push32le(2*a),c.push16le(1),c.push16le(32),c.push32le(0),c.push32le(d+f),c.push32le(0),c.push32le(0),c.push32le(0),c.push32le(0);var p,g;for(p=a-1;p>=0;p--)for(g=0;g<h;g++)if(g>=n||p>=o)c.push(0),c.push(0),c.push(0),c.push(0);else{var y=p*Math.ceil(n/8)+Math.floor(g/8),b=i[y]<<g%8&128?255:0;if(_){y=n*p+g;var v=_[e[y]];c.push(v[2]),c.push(v[1]),c.push(v[0]),c.push(b)}else y=4*(n*p+g),c.push(e[y+2]),c.push(e[y+1]),c.push(e[y]),c.push(b)}for(p=0;p<a;p++)for(g=0;g<Math.ceil(h/8);g++)c.push(0);for(p=0;p<a;p++)for(g=0;g<Math.ceil(h/8);g++)c.push(0);var m="data:image/x-icon;base64,"+Base64.encode(c);t.style.cursor="url("+m+")"+s+" "+r+", default"}}();var RFB;!function(){"use strict";RFB=function(t){t||(t={}),this._rfb_host="",this._rfb_port=5900,this._rfb_password="",this._rfb_path="",this._rfb_state="disconnected",this._rfb_version=0,this._rfb_max_version=3.8,this._rfb_auth_scheme="",this._rfb_tightvnc=!1,this._rfb_xvp_ver=0,this._encodings=[["COPYRECT",1],["TIGHT",7],["TIGHT_PNG",-260],["HEXTILE",5],["RRE",2],["RAW",0],["DesktopSize",-223],["Cursor",-239],["JPEG_quality_med",-26],["compress_hi",-247],["last_rect",-224],["xvp",-309],["ExtendedDesktopSize",-308]],this._encHandlers={},this._encNames={},this._encStats={},this._sock=null,this._display=null,this._keyboard=null,this._mouse=null,this._sendTimer=null,this._disconnTimer=null,this._msgTimer=null,this._FBU={rects:0,subrects:0,lines:0,tiles:0,bytes:0,x:0,y:0,width:0,height:0,encoding:0,subencoding:-1,background:null,zlib:[]},this._fb_Bpp=4,this._fb_depth=3,this._fb_width=0,this._fb_height=0,this._fb_name="",this._destBuff=null,this._paletteBuff=new Uint8Array(1024),this._rre_chunk_sz=100,this._timing={last_fbu:0,fbu_total:0,fbu_total_cnt:0,full_fbu_total:0,full_fbu_cnt:0,fbu_rt_start:0,fbu_rt_total:0,fbu_rt_cnt:0,pixels:0},this._supportsSetDesktopSize=!1,this._screen_id=0,this._screen_flags=0,this._mouse_buttonMask=0,this._mouse_arr=[],this._viewportDragging=!1,this._viewportDragPos={},this._viewportHasMoved=!1,Util.set_defaults(this,t,{target:"null",focusContainer:document,encrypt:!1,true_color:!0,local_cursor:!1,shared:!0,view_only:!1,xvp_password_sep:"@",disconnectTimeout:3,wsProtocols:["binary"],repeaterID:"",viewportDrag:!1,onUpdateState:function(){},onPasswordRequired:function(){},onClipboard:function(){},onBell:function(){},onFBUReceive:function(){},onFBUComplete:function(){},onFBResize:function(){},onDesktopName:function(){},onXvpInit:function(){}}),Util.Debug(">> RFB.constructor"),Object.keys(RFB.encodingHandlers).forEach(function(t){this._encHandlers[t]=RFB.encodingHandlers[t].bind(this)}.bind(this));for(var e=0;e<this._encodings.length;e++)this._encHandlers[this._encodings[e][1]]=this._encHandlers[this._encodings[e][0]],this._encNames[this._encodings[e][1]]=this._encodings[e][0],this._encStats[this._encodings[e][1]]=[0,0];try{this._display=new Display({target:this._target})}catch(i){throw Util.Error("Display exception: "+i),i}this._keyboard=new Keyboard({target:this._focusContainer,onKeyPress:this._handleKeyPress.bind(this)}),this._mouse=new Mouse({target:this._target,onMouseButton:this._handleMouseButton.bind(this),onMouseMove:this._handleMouseMove.bind(this),notify:this._keyboard.sync.bind(this._keyboard)}),this._sock=new Websock,this._sock.on("message",this._handle_message.bind(this)),this._sock.on("open",function(){"connect"===this._rfb_state?this._updateState("ProtocolVersion","Starting VNC handshake"):this._fail("Got unexpected WebSocket connection")}.bind(this)),this._sock.on("close",function(t){Util.Warn("WebSocket on-close event");var e="";t.code&&(e=" (code: "+t.code,t.reason&&(e+=", reason: "+t.reason),e+=")"),"disconnect"===this._rfb_state?this._updateState("disconnected","VNC disconnected"+e):"ProtocolVersion"===this._rfb_state?this._fail("Failed to connect to server"+e):this._rfb_state in{failed:1,disconnected:1}?Util.Error("Received onclose while disconnected"+e):this._fail("Server disconnected"+e),this._sock.off("close")}.bind(this)),this._sock.on("error",function(t){Util.Warn("WebSocket on-error event")}),this._init_vars();var s=this._display.get_render_mode();if(!Websock_native)throw this._cleanupSocket("fatal"),new Error("WebSocket support is required to use noVNC");Util.Info("Using native WebSockets"),this._updateState("loaded","noVNC ready: native WebSockets, "+s),Util.Debug("<< RFB.constructor")},RFB.prototype={connect:function(t,e,i,s){return this._rfb_host=t,this._rfb_port=e,this._rfb_password=void 0!==i?i:"",this._rfb_path=void 0!==s?s:"",this._rfb_host&&this._rfb_port?void this._updateState("connect"):this._fail("Must set host and port")},disconnect:function(){this._updateState("disconnect","Disconnecting"),this._sock.off("error"),this._sock.off("message"),this._sock.off("open")},sendPassword:function(t){this._rfb_password=t,this._rfb_state="Authentication",setTimeout(this._init_msg.bind(this),1)},sendCtrlAltDel:function(){return"normal"===this._rfb_state&&!this._view_only&&(Util.Info("Sending Ctrl-Alt-Del"),RFB.messages.keyEvent(this._sock,XK_Control_L,1),RFB.messages.keyEvent(this._sock,XK_Alt_L,1),RFB.messages.keyEvent(this._sock,XK_Delete,1),RFB.messages.keyEvent(this._sock,XK_Delete,0),RFB.messages.keyEvent(this._sock,XK_Alt_L,0),RFB.messages.keyEvent(this._sock,XK_Control_L,0),void this._sock.flush())},xvpOp:function(t,e){return!(this._rfb_xvp_ver<t)&&(Util.Info("Sending XVP operation "+e+" (version "+t+")"),this._sock.send_string("\0"+String.fromCharCode(t)+String.fromCharCode(e)),!0)},xvpShutdown:function(){return this.xvpOp(1,2)},xvpReboot:function(){return this.xvpOp(1,3)},xvpReset:function(){return this.xvpOp(1,4)},sendKey:function(t,e){return"normal"===this._rfb_state&&!this._view_only&&("undefined"!=typeof e?(Util.Info("Sending key code ("+(e?"down":"up")+"): "+t),RFB.messages.keyEvent(this._sock,t,e?1:0)):(Util.Info("Sending key code (down + up): "+t),RFB.messages.keyEvent(this._sock,t,1),RFB.messages.keyEvent(this._sock,t,0)),void this._sock.flush())},clipboardPasteFrom:function(t){"normal"===this._rfb_state&&(RFB.messages.clientCutText(this._sock,t),this._sock.flush())},requestDesktopSize:function(t,e){"normal"===this._rfb_state&&this._supportsSetDesktopSize&&(RFB.messages.setDesktopSize(this._sock,t,e,this._screen_id,this._screen_flags),this._sock.flush())},_connect:function(){Util.Debug(">> RFB.connect");var t;t="undefined"!=typeof UsingSocketIO?"http":this._encrypt?"wss":"ws",t+="://"+this._rfb_host+":"+this._rfb_port+"/"+this._rfb_path,Util.Info("connecting to "+t),this._sock.open(t,this._wsProtocols),Util.Debug("<< RFB.connect")},_init_vars:function(){this._FBU.rects=0,this._FBU.subrects=0,this._FBU.lines=0,this._FBU.tiles=0,this._FBU.zlibs=[],this._mouse_buttonMask=0,this._mouse_arr=[],this._rfb_tightvnc=!1;var t;for(t=0;t<this._encodings.length;t++)this._encStats[this._encodings[t][1]][0]=0;for(t=0;t<4;t++)this._FBU.zlibs[t]=new inflator.Inflate},_print_stats:function(){Util.Info("Encoding stats for this connection:");var t,e;for(t=0;t<this._encodings.length;t++)e=this._encStats[this._encodings[t][1]],e[0]+e[1]>0&&Util.Info("    "+this._encodings[t][0]+": "+e[0]+" rects");for(Util.Info("Encoding stats since page load:"),t=0;t<this._encodings.length;t++)e=this._encStats[this._encodings[t][1]],Util.Info("    "+this._encodings[t][0]+": "+e[1]+" rects")},_cleanupSocket:function(t){this._sendTimer&&(clearInterval(this._sendTimer),this._sendTimer=null),this._msgTimer&&(clearInterval(this._msgTimer),this._msgTimer=null),this._display&&this._display.get_context()&&(this._keyboard.ungrab(),this._mouse.ungrab(),"connect"!==t&&"loaded"!==t&&this._display.defaultCursor(),"debug"===Util.get_logging()&&"loaded"!==t||this._display.clear()),this._sock.close()},_updateState:function(t,e){var i=this._rfb_state;t===i&&Util.Debug("Already in state '"+t+"', ignoring"),t in{disconnected:1,loaded:1,connect:1,disconnect:1,failed:1,fatal:1}&&this._cleanupSocket(t),"fatal"===i&&Util.Error("Fatal error, cannot continue");var s="undefined"!=typeof e?" Msg: "+e:"";switch("failed"===t||"fatal"===t?Util.Error(s):Util.Warn(s),"failed"===i&&"disconnected"===t?this._rfb_state="failed":this._rfb_state=t,this._disconnTimer&&"disconnect"!==this._rfb_state&&(Util.Debug("Clearing disconnect timer"),clearTimeout(this._disconnTimer),this._disconnTimer=null,this._sock.off("close")),t){case"normal":"disconnected"!==i&&"failed"!==i||Util.Error("Invalid transition from 'disconnected' or 'failed' to 'normal'");break;case"connect":this._init_vars(),this._connect();break;case"disconnect":this._disconnTimer=setTimeout(function(){this._fail("Disconnect timeout")}.bind(this),1e3*this._disconnectTimeout),this._print_stats();break;case"failed":"disconnected"===i?Util.Error("Invalid transition from 'disconnected' to 'failed'"):"normal"===i?Util.Error("Error while connected."):"init"===i&&Util.Error("Error while initializing."),setTimeout(function(){this._updateState("disconnected")}.bind(this),50)}"failed"===i&&"disconnected"===t?this._onUpdateState(this,t,i):this._onUpdateState(this,t,i,e)},_fail:function(t){return this._updateState("failed",t),!1},_handle_message:function(){if(0===this._sock.rQlen())return void Util.Warn("handle_message called on an empty receive queue");switch(this._rfb_state){case"disconnected":case"failed":Util.Error("Got data while disconnected");break;case"normal":this._normal_msg()&&this._sock.rQlen()>0&&(null===this._msgTimer?(Util.Debug("More data to process, creating timer"),this._msgTimer=setTimeout(function(){this._msgTimer=null,this._handle_message()}.bind(this),10)):Util.Debug("More data to process, existing timer"));break;default:this._init_msg()}},_handleKeyPress:function(t,e){this._view_only||(RFB.messages.keyEvent(this._sock,t,e),this._sock.flush())},_handleMouseButton:function(t,e,i,s){if(i?this._mouse_buttonMask|=s:this._mouse_buttonMask^=s,this._viewportDrag){if(i&&!this._viewportDragging)return this._viewportDragging=!0,void(this._viewportDragPos={x:t,y:e});this._viewportDragging=!1,this._viewportHasMoved||this._view_only||RFB.messages.pointerEvent(this._sock,this._display.absX(t),this._display.absY(e),s),this._viewportHasMoved=!1}this._view_only||"normal"===this._rfb_state&&RFB.messages.pointerEvent(this._sock,this._display.absX(t),this._display.absY(e),this._mouse_buttonMask)},_handleMouseMove:function(t,e){if(this._viewportDragging){var i=this._viewportDragPos.x-t,s=this._viewportDragPos.y-e,r=10*(window.devicePixelRatio||1);return void((this._viewportHasMoved||Math.abs(i)>r||Math.abs(s)>r)&&(this._viewportHasMoved=!0,this._viewportDragPos={x:t,y:e},this._display.viewportChangePos(i,s)))}this._view_only||"normal"===this._rfb_state&&RFB.messages.pointerEvent(this._sock,this._display.absX(t),this._display.absY(e),this._mouse_buttonMask)},_negotiate_protocol_version:function(){if(this._sock.rQlen()<12)return this._fail("Incomplete protocol version");var t=this._sock.rQshiftStr(12).substr(4,7);Util.Info("Server ProtocolVersion: "+t);var e=0;switch(t){case"000.000":e=1;break;case"003.003":case"003.006":case"003.889":this._rfb_version=3.3;break;case"003.007":this._rfb_version=3.7;break;case"003.008":case"004.000":case"004.001":this._rfb_version=3.8;break;default:return this._fail("Invalid server version "+t)}if(e){for(var i=this._repeaterID;i.length<250;)i+="\0";return this._sock.send_string(i),!0}this._rfb_version>this._rfb_max_version&&(this._rfb_version=this._rfb_max_version),this._sendTimer=setInterval(this._sock.flush.bind(this._sock),50);var s="00"+parseInt(this._rfb_version,10)+".00"+10*this._rfb_version%10;this._sock.send_string("RFB "+s+"\n"),this._updateState("Security","Sent ProtocolVersion: "+s)},_negotiate_security:function(){if(this._rfb_version>=3.7){var t=this._sock.rQshift8();if(this._sock.rQwait("security type",t,1))return!1;if(0===t){var e=this._sock.rQshift32(),i=this._sock.rQshiftStr(e);return this._fail("Security failure: "+i)}this._rfb_auth_scheme=0;var s=this._sock.rQshiftBytes(t);Util.Debug("Server security types: "+s);for(var r=0;r<s.length;r++)s[r]>this._rfb_auth_scheme&&(s[r]<=16||22==s[r])&&(this._rfb_auth_scheme=s[r]);if(0===this._rfb_auth_scheme)return this._fail("Unsupported security types: "+s);this._sock.send([this._rfb_auth_scheme])}else{if(this._sock.rQwait("security scheme",4))return!1;this._rfb_auth_scheme=this._sock.rQshift32()}return this._updateState("Authentication","Authenticating using scheme: "+this._rfb_auth_scheme),this._init_msg()},_negotiate_xvp_auth:function(){var t=this._xvp_password_sep,e=this._rfb_password.split(t);if(e.length<3)return this._updateState("password","XVP credentials required (user"+t+"target"+t+"password) -- got only "+this._rfb_password),this._onPasswordRequired(this),!1;var i=String.fromCharCode(e[0].length)+String.fromCharCode(e[1].length)+e[0]+e[1];return this._sock.send_string(i),this._rfb_password=e.slice(2).join(t),this._rfb_auth_scheme=2,this._negotiate_authentication()},_negotiate_std_vnc_auth:function(){if(0===this._rfb_password.length)return this._updateState("password","Password Required"),this._onPasswordRequired(this),!1;if(this._sock.rQwait("auth challenge",16))return!1;var t=Array.prototype.slice.call(this._sock.rQshiftBytes(16)),e=RFB.genDES(this._rfb_password,t);return this._sock.send(e),this._updateState("SecurityResult"),!0},_negotiate_tight_tunnels:function(t){for(var e={0:{vendor:"TGHT",signature:"NOTUNNEL"}},i={},s=0;s<t;s++){var r=this._sock.rQshift32(),n=this._sock.rQshiftStr(4),o=this._sock.rQshiftStr(8);i[r]={vendor:n,signature:o}}return i[0]?i[0].vendor!=e[0].vendor||i[0].signature!=e[0].signature?this._fail("Client's tunnel type had the incorrect vendor or signature"):(this._sock.send([0,0,0,0]),!1):this._fail("Server wanted tunnels, but doesn't support the notunnel type")},_negotiate_tight_auth:function(){if(!this._rfb_tightvnc){if(this._sock.rQwait("num tunnels",4))return!1;var t=this._sock.rQshift32();if(t>0&&this._sock.rQwait("tunnel capabilities",16*t,4))return!1;if(this._rfb_tightvnc=!0,t>0)return this._negotiate_tight_tunnels(t),!1}if(this._sock.rQwait("sub auth count",4))return!1;var e=this._sock.rQshift32();if(this._sock.rQwait("sub auth capabilities",16*e,4))return!1;for(var i={STDVNOAUTH__:1,STDVVNCAUTH_:2},s=[],r=0;r<e;r++){var n=(this._sock.rQshift32(),this._sock.rQshiftStr(12));s.push(n)}for(var o in i)if(s.indexOf(o)!=-1)switch(this._sock.send([0,0,0,i[o]]),o){case"STDVNOAUTH__":return this._updateState("SecurityResult"),!0;case"STDVVNCAUTH_":return this._rfb_auth_scheme=2,this._init_msg();default:return this._fail("Unsupported tiny auth scheme: "+o)}this._fail("No supported sub-auth types!")},_negotiate_authentication:function(){switch(this._rfb_auth_scheme){case 0:if(this._sock.rQwait("auth reason",4))return!1;var t=this._sock.rQshift32(),e=this._sock.rQshiftStr(t);return this._fail("Auth failure: "+e);case 1:return this._rfb_version>=3.8?(this._updateState("SecurityResult"),!0):(this._updateState("ClientInitialisation","No auth required"),this._init_msg());case 22:return this._negotiate_xvp_auth();case 2:return this._negotiate_std_vnc_auth();case 16:return this._negotiate_tight_auth();default:return this._fail("Unsupported auth scheme: "+this._rfb_auth_scheme)}},_handle_security_result:function(){if(this._sock.rQwait("VNC auth response ",4))return!1;switch(this._sock.rQshift32()){case 0:return this._updateState("ClientInitialisation","Authentication OK"),this._init_msg();case 1:if(this._rfb_version>=3.8){var t=this._sock.rQshift32();if(this._sock.rQwait("SecurityResult reason",t,8))return!1;var e=this._sock.rQshiftStr(t);return this._fail(e)}return this._fail("Authentication failure");case 2:return this._fail("Too many auth attempts")}},_negotiate_server_init:function(){if(this._sock.rQwait("server initialization",24))return!1;this._fb_width=this._sock.rQshift16(),this._fb_height=this._sock.rQshift16(),this._destBuff=new Uint8Array(this._fb_width*this._fb_height*4);var t=this._sock.rQshift8(),e=this._sock.rQshift8(),i=this._sock.rQshift8(),s=this._sock.rQshift8(),r=this._sock.rQshift16(),n=this._sock.rQshift16(),o=this._sock.rQshift16(),_=this._sock.rQshift8(),h=this._sock.rQshift8(),a=this._sock.rQshift8();this._sock.rQskipBytes(3);var c=this._sock.rQshift32();if(this._sock.rQwait("server init name",c,24))return!1;if(this._fb_name=Util.decodeUTF8(this._sock.rQshiftStr(c)),this._rfb_tightvnc){if(this._sock.rQwait("TightVNC extended server init header",8,24+c))return!1;var u=this._sock.rQshift16(),l=this._sock.rQshift16(),d=this._sock.rQshift16();this._sock.rQskipBytes(2);var f=16*(u+l+d);if(this._sock.rQwait("TightVNC extended server init header",f,32+c))return!1;this._sock.rQskipBytes(16*u),this._sock.rQskipBytes(16*l),this._sock.rQskipBytes(16*d)}Util.Info("Screen: "+this._fb_width+"x"+this._fb_height+", bpp: "+t+", depth: "+e+", big_endian: "+i+", true_color: "+s+", red_max: "+r+", green_max: "+n+", blue_max: "+o+", red_shift: "+_+", green_shift: "+h+", blue_shift: "+a),0!==i&&Util.Warn("Server native endian is not little endian"),16!==_&&Util.Warn("Server native red-shift is not 16"),0!==a&&Util.Warn("Server native blue-shift is not 0"),this._onDesktopName(this,this._fb_name),this._true_color&&"Intel(r) AMT KVM"===this._fb_name&&(Util.Warn("Intel AMT KVM only supports 8/16 bit depths.  Disabling true color"),this._true_color=!1),this._display.set_true_color(this._true_color),this._display.resize(this._fb_width,this._fb_height),this._onFBResize(this,this._fb_width,this._fb_height),this._keyboard.grab(),this._mouse.grab(),this._true_color?(this._fb_Bpp=4,this._fb_depth=3):(this._fb_Bpp=1,this._fb_depth=1),RFB.messages.pixelFormat(this._sock,this._fb_Bpp,this._fb_depth,this._true_color),RFB.messages.clientEncodings(this._sock,this._encodings,this._local_cursor,this._true_color),RFB.messages.fbUpdateRequests(this._sock,this._display.getCleanDirtyReset(),this._fb_width,this._fb_height),this._timing.fbu_rt_start=(new Date).getTime(),this._timing.pixels=0,this._sock.flush(),this._encrypt?this._updateState("normal","Connected (encrypted) to: "+this._fb_name):this._updateState("normal","Connected (unencrypted) to: "+this._fb_name)},_init_msg:function(){switch(this._rfb_state){case"ProtocolVersion":return this._negotiate_protocol_version();case"Security":return this._negotiate_security();case"Authentication":return this._negotiate_authentication();case"SecurityResult":return this._handle_security_result();case"ClientInitialisation":return this._sock.send([this._shared?1:0]),this._updateState("ServerInitialisation","Authentication OK"),!0;case"ServerInitialisation":return this._negotiate_server_init()}},_handle_set_colour_map_msg:function(){Util.Debug("SetColorMapEntries"),this._sock.rQskip8();var t=this._sock.rQshift16(),e=this._sock.rQshift16();if(this._sock.rQwait("SetColorMapEntries",6*e,6))return!1;for(var i=0;i<e;i++){var s=parseInt(this._sock.rQshift16()/256,10),r=parseInt(this._sock.rQshift16()/256,10),n=parseInt(this._sock.rQshift16()/256,10);this._display.set_colourMap([n,r,s],t+i)}return Util.Debug("colourMap: "+this._display.get_colourMap()),Util.Info("Registered "+e+" colourMap entries"),!0},_handle_server_cut_text:function(){if(Util.Debug("ServerCutText"),this._sock.rQwait("ServerCutText header",7,1))return!1;this._sock.rQskipBytes(3);var t=this._sock.rQshift32();if(this._sock.rQwait("ServerCutText",t,8))return!1;var e=this._sock.rQshiftStr(t);return this._onClipboard(this,e),!0},_handle_xvp_msg:function(){if(this._sock.rQwait("XVP version and message",3,1))return!1;this._sock.rQskip8();var t=this._sock.rQshift8(),e=this._sock.rQshift8();switch(e){case 0:this._updateState(this._rfb_state,"Operation Failed");break;case 1:this._rfb_xvp_ver=t,Util.Info("XVP extensions enabled (version "+this._rfb_xvp_ver+")"),this._onXvpInit(this._rfb_xvp_ver);break;default:this._fail("Disconnected: illegal server XVP message "+e)}return!0},_normal_msg:function(){var t;switch(t=this._FBU.rects>0?0:this._sock.rQshift8()){case 0:var e=this._framebufferUpdate();return e&&(RFB.messages.fbUpdateRequests(this._sock,this._display.getCleanDirtyReset(),this._fb_width,this._fb_height),this._sock.flush()),e;case 1:return this._handle_set_colour_map_msg();case 2:return Util.Debug("Bell"),this._onBell(this),!0;case 3:return this._handle_server_cut_text();case 250:return this._handle_xvp_msg();default:return this._fail("Disconnected: illegal server message type "+t),Util.Debug("sock.rQslice(0, 30): "+this._sock.rQslice(0,30)),!0}},_framebufferUpdate:function(){var t,e=!0;if(0===this._FBU.rects){if(this._sock.rQwait("FBU header",3,1))return!1;this._sock.rQskip8(),this._FBU.rects=this._sock.rQshift16(),this._FBU.bytes=0,this._timing.cur_fbu=0,this._timing.fbu_rt_start>0&&(t=(new Date).getTime(),Util.Info("First FBU latency: "+(t-this._timing.fbu_rt_start)))}for(;this._FBU.rects>0;){if("normal"!==this._rfb_state)return!1;if(this._sock.rQwait("FBU",this._FBU.bytes))return!1;if(0===this._FBU.bytes){if(this._sock.rQwait("rect header",12))return!1;var i=this._sock.rQshiftBytes(12);if(this._FBU.x=(i[0]<<8)+i[1],this._FBU.y=(i[2]<<8)+i[3],this._FBU.width=(i[4]<<8)+i[5],this._FBU.height=(i[6]<<8)+i[7],this._FBU.encoding=parseInt((i[8]<<24)+(i[9]<<16)+(i[10]<<8)+i[11],10),this._onFBUReceive(this,{x:this._FBU.x,y:this._FBU.y,width:this._FBU.width,height:this._FBU.height,encoding:this._FBU.encoding,encodingName:this._encNames[this._FBU.encoding]}),!this._encNames[this._FBU.encoding])return this._fail("Disconnected: unsupported encoding "+this._FBU.encoding),!1}this._timing.last_fbu=(new Date).getTime();var s=this._encHandlers[this._FBU.encoding];try{e=s()}catch(r){console.log("missed "+this._FBU.encoding+": "+s),e=this._encHandlers[this._FBU.encoding]()}if(t=(new Date).getTime(),this._timing.cur_fbu+=t-this._timing.last_fbu,e&&(this._encStats[this._FBU.encoding][0]++,this._encStats[this._FBU.encoding][1]++,this._timing.pixels+=this._FBU.width*this._FBU.height),this._timing.pixels>=this._fb_width*this._fb_height&&((this._FBU.width===this._fb_width&&this._FBU.height===this._fb_height||this._timing.fbu_rt_start>0)&&(this._timing.full_fbu_total+=this._timing.cur_fbu,this._timing.full_fbu_cnt++,Util.Info("Timing of full FBU, curr: "+this._timing.cur_fbu+", total: "+this._timing.full_fbu_total+", cnt: "+this._timing.full_fbu_cnt+", avg: "+this._timing.full_fbu_total/this._timing.full_fbu_cnt)),this._timing.fbu_rt_start>0)){var n=t-this._timing.fbu_rt_start;this._timing.fbu_rt_total+=n,this._timing.fbu_rt_cnt++,Util.Info("full FBU round-trip, cur: "+n+", total: "+this._timing.fbu_rt_total+", cnt: "+this._timing.fbu_rt_cnt+", avg: "+this._timing.fbu_rt_total/this._timing.fbu_rt_cnt),this._timing.fbu_rt_start=0}if(!e)return e}return this._onFBUComplete(this,{x:this._FBU.x,y:this._FBU.y,width:this._FBU.width,height:this._FBU.height,encoding:this._FBU.encoding,encodingName:this._encNames[this._FBU.encoding]}),!0}},Util.make_properties(RFB,[["target","wo","dom"],["focusContainer","wo","dom"],["encrypt","rw","bool"],["true_color","rw","bool"],["local_cursor","rw","bool"],["shared","rw","bool"],["view_only","rw","bool"],["xvp_password_sep","rw","str"],["disconnectTimeout","rw","int"],["wsProtocols","rw","arr"],["repeaterID","rw","str"],["viewportDrag","rw","bool"],["onUpdateState","rw","func"],["onPasswordRequired","rw","func"],["onClipboard","rw","func"],["onBell","rw","func"],["onFBUReceive","rw","func"],["onFBUComplete","rw","func"],["onFBResize","rw","func"],["onDesktopName","rw","func"],["onXvpInit","rw","func"]]),RFB.prototype.set_local_cursor=function(t){!t||t in{0:1,no:1,"false":1}?(this._local_cursor=!1,this._display.disableLocalCursor()):this._display.get_cursor_uri()?this._local_cursor=!0:(Util.Warn("Browser does not support local cursor"),this._display.disableLocalCursor())},RFB.prototype.get_display=function(){return this._display},RFB.prototype.get_keyboard=function(){return this._keyboard},RFB.prototype.get_mouse=function(){return this._mouse},RFB.messages={keyEvent:function(t,e,i){var s=t._sQ,r=t._sQlen;s[r]=4,s[r+1]=i,s[r+2]=0,s[r+3]=0,s[r+4]=e>>24,s[r+5]=e>>16,s[r+6]=e>>8,s[r+7]=e,t._sQlen+=8},pointerEvent:function(t,e,i,s){var r=t._sQ,n=t._sQlen;r[n]=5,r[n+1]=s,r[n+2]=e>>8,r[n+3]=e,r[n+4]=i>>8,r[n+5]=i,t._sQlen+=6},clientCutText:function(t,e){var i=t._sQ,s=t._sQlen;i[s]=6,i[s+1]=0,i[s+2]=0,i[s+3]=0;var r=e.length;i[s+4]=r>>24,i[s+5]=r>>16,i[s+6]=r>>8,i[s+7]=r;for(var n=0;n<r;n++)i[s+8+n]=e.charCodeAt(n);t._sQlen+=8+r},setDesktopSize:function(t,e,i,s,r){var n=t._sQ,o=t._sQlen;n[o]=251,n[o+1]=0,n[o+2]=e>>8,n[o+3]=e,n[o+4]=i>>8,n[o+5]=i,n[o+6]=1,n[o+7]=0,n[o+8]=s>>24,n[o+9]=s>>16,n[o+10]=s>>8,n[o+11]=s,n[o+12]=0,n[o+13]=0,n[o+14]=0,n[o+15]=0,n[o+16]=e>>8,n[o+17]=e,n[o+18]=i>>8,n[o+19]=i,n[o+20]=r>>24,n[o+21]=r>>16,n[o+22]=r>>8,n[o+23]=r,t._sQlen+=24},pixelFormat:function(t,e,i,s){var r=t._sQ,n=t._sQlen;r[n]=0,r[n+1]=0,r[n+2]=0,r[n+3]=0,r[n+4]=8*e,r[n+5]=8*i,r[n+6]=0,r[n+7]=s?1:0,r[n+8]=0,r[n+9]=255,r[n+10]=0,r[n+11]=255,r[n+12]=0,r[n+13]=255,r[n+14]=16,r[n+15]=8,r[n+16]=0,r[n+17]=0,r[n+18]=0,r[n+19]=0,t._sQlen+=20},clientEncodings:function(t,e,i,s){var r=t._sQ,n=t._sQlen;r[n]=2,r[n+1]=0;var o,_=n+4,h=0;for(o=0;o<e.length;o++)if("Cursor"!==e[o][0]||i)if("TIGHT"!==e[o][0]||s){var a=e[o][1];r[_]=a>>24,r[_+1]=a>>16,r[_+2]=a>>8,r[_+3]=a,_+=4,h++}else Util.Warn("Skipping tight as it is only supported with true color");else Util.Debug("Skipping Cursor pseudo-encoding");r[n+2]=h>>8,r[n+3]=h,t._sQlen+=_-n},fbUpdateRequests:function(t,e,i,s){var r,n,o=e.cleanBox;o.w>0&&o.h>0&&(r="undefined"==typeof o.w?i:o.w,n="undefined"==typeof o.h?s:o.h,RFB.messages.fbUpdateRequest(t,1,o.x,o.y,r,n));for(var _=0;_<e.dirtyBoxes.length;_++){var h=e.dirtyBoxes[_];r="undefined"==typeof h.w?i:h.w,n="undefined"==typeof h.h?s:h.h,RFB.messages.fbUpdateRequest(t,0,h.x,h.y,r,n)}},fbUpdateRequest:function(t,e,i,s,r,n){var o=t._sQ,_=t._sQlen;"undefined"==typeof i&&(i=0),"undefined"==typeof s&&(s=0),o[_]=3,o[_+1]=e,o[_+2]=i>>8&255,o[_+3]=255&i,o[_+4]=s>>8&255,o[_+5]=255&s,o[_+6]=r>>8&255,o[_+7]=255&r,o[_+8]=n>>8&255,o[_+9]=255&n,t._sQlen+=10}},RFB.genDES=function(t,e){for(var i=[],s=0;s<t.length;s++)i.push(t.charCodeAt(s));return new DES(i).encrypt(e)},RFB.extract_data_uri=function(t){return";base64,"+Base64.encode(t)},RFB.encodingHandlers={RAW:function(){if(0===this._FBU.lines&&(this._FBU.lines=this._FBU.height),this._FBU.bytes=this._FBU.width*this._fb_Bpp,this._sock.rQwait("RAW",this._FBU.bytes))return!1;var t=this._FBU.y+(this._FBU.height-this._FBU.lines),e=Math.min(this._FBU.lines,Math.floor(this._sock.rQlen()/(this._FBU.width*this._fb_Bpp)));return this._display.blitImage(this._FBU.x,t,this._FBU.width,e,this._sock.get_rQ(),this._sock.get_rQi()),this._sock.rQskipBytes(this._FBU.width*e*this._fb_Bpp),this._FBU.lines-=e,this._FBU.lines>0?this._FBU.bytes=this._FBU.width*this._fb_Bpp:(this._FBU.rects--,this._FBU.bytes=0),!0},COPYRECT:function(){return this._FBU.bytes=4,!this._sock.rQwait("COPYRECT",4)&&(this._display.copyImage(this._sock.rQshift16(),this._sock.rQshift16(),this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height),this._FBU.rects--,this._FBU.bytes=0,!0)},RRE:function(){var t;if(0===this._FBU.subrects){if(this._FBU.bytes=4+this._fb_Bpp,this._sock.rQwait("RRE",4+this._fb_Bpp))return!1;this._FBU.subrects=this._sock.rQshift32(),t=this._sock.rQshiftBytes(this._fb_Bpp),this._display.fillRect(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,t)}for(;this._FBU.subrects>0&&this._sock.rQlen()>=this._fb_Bpp+8;){t=this._sock.rQshiftBytes(this._fb_Bpp);var e=this._sock.rQshift16(),i=this._sock.rQshift16(),s=this._sock.rQshift16(),r=this._sock.rQshift16();this._display.fillRect(this._FBU.x+e,this._FBU.y+i,s,r,t),this._FBU.subrects--}if(this._FBU.subrects>0){var n=Math.min(this._rre_chunk_sz,this._FBU.subrects);this._FBU.bytes=(this._fb_Bpp+8)*n}else this._FBU.rects--,this._FBU.bytes=0;return!0},HEXTILE:function(){var t=this._sock.get_rQ(),e=this._sock.get_rQi();for(0===this._FBU.tiles&&(this._FBU.tiles_x=Math.ceil(this._FBU.width/16),this._FBU.tiles_y=Math.ceil(this._FBU.height/16),this._FBU.total_tiles=this._FBU.tiles_x*this._FBU.tiles_y,this._FBU.tiles=this._FBU.total_tiles);this._FBU.tiles>0;){if(this._FBU.bytes=1,this._sock.rQwait("HEXTILE subencoding",this._FBU.bytes))return!1;var i=t[e];if(i>30)return this._fail("Disconnected: illegal hextile subencoding "+i),!1;var s=0,r=this._FBU.total_tiles-this._FBU.tiles,n=r%this._FBU.tiles_x,o=Math.floor(r/this._FBU.tiles_x),_=this._FBU.x+16*n,h=this._FBU.y+16*o,a=Math.min(16,this._FBU.x+this._FBU.width-_),c=Math.min(16,this._FBU.y+this._FBU.height-h);if(1&i)this._FBU.bytes+=a*c*this._fb_Bpp;else if(2&i&&(this._FBU.bytes+=this._fb_Bpp),4&i&&(this._FBU.bytes+=this._fb_Bpp),8&i){if(this._FBU.bytes++,this._sock.rQwait("hextile subrects header",this._FBU.bytes))return!1;s=t[e+this._FBU.bytes-1],16&i?this._FBU.bytes+=s*(this._fb_Bpp+2):this._FBU.bytes+=2*s}if(this._sock.rQwait("hextile",this._FBU.bytes))return!1;if(this._FBU.subencoding=t[e],e++,0===this._FBU.subencoding)1&this._FBU.lastsubencoding?Util.Debug("     Ignoring blank after RAW"):this._display.fillRect(_,h,a,c,this._FBU.background);else if(1&this._FBU.subencoding)this._display.blitImage(_,h,a,c,t,e),e+=this._FBU.bytes-1;else{if(2&this._FBU.subencoding&&(1==this._fb_Bpp?this._FBU.background=t[e]:this._FBU.background=[t[e],t[e+1],t[e+2],t[e+3]],e+=this._fb_Bpp),4&this._FBU.subencoding&&(1==this._fb_Bpp?this._FBU.foreground=t[e]:this._FBU.foreground=[t[e],t[e+1],t[e+2],t[e+3]],e+=this._fb_Bpp),this._display.startTile(_,h,a,c,this._FBU.background),8&this._FBU.subencoding){s=t[e],e++;for(var u=0;u<s;u++){var l;16&this._FBU.subencoding?(l=1===this._fb_Bpp?t[e]:[t[e],t[e+1],t[e+2],t[e+3]],e+=this._fb_Bpp):l=this._FBU.foreground;var d=t[e];e++;var f=d>>4,p=15&d,g=t[e];e++;var y=(g>>4)+1,b=(15&g)+1;this._display.subTile(f,p,y,b,l)}}this._display.finishTile()}this._sock.set_rQi(e),this._FBU.lastsubencoding=this._FBU.subencoding,this._FBU.bytes=0,this._FBU.tiles--}return 0===this._FBU.tiles&&this._FBU.rects--,!0},getTightCLength:function(t){var e=1,i=0;return i+=127&t[0],128&t[0]&&(e++,i+=(127&t[1])<<7,128&t[1]&&(e++,i+=t[2]<<14)),[e,i]},display_tight:function(t){if(1===this._fb_depth&&this._fail("Tight protocol handler only implements true color mode"),this._FBU.bytes=1,this._sock.rQwait("TIGHT compression-control",this._FBU.bytes))return!1;var e,i,s,r,n=0,o=-1,_=function(t,e){for(var i=0;i<4;i++)n>>i&1&&(this._FBU.zlibs[i].reset(),console.debug("RESET!"),Util.Info("Reset zlib stream "+i));var s=this._FBU.zlibs[o].inflate(t,!0,e);return s}.bind(this),h=function(t,e,i,s){for(var r=this._destBuff,n=Math.floor((i+7)/8),o=Math.floor(i/8),_=0;_<s;_++){var h,a,c,u;for(a=0;a<o;a++)for(h=7;h>=0;h--)c=4*(_*i+8*a+7-h),
u=3*(t[_*n+a]>>h&1),r[c]=e[u],r[c+1]=e[u+1],r[c+2]=e[u+2],r[c+3]=255;for(h=7;h>=8-i%8;h--)c=4*(_*i+8*a+7-h),u=3*(t[_*n+a]>>h&1),r[c]=e[u],r[c+1]=e[u+1],r[c+2]=e[u+2],r[c+3]=255}return r}.bind(this),a=function(t,e,i,s){for(var r=this._destBuff,n=i*s*4,o=0,_=0;o<n;o+=4,_++){var h=3*t[_];r[o]=e[h],r[o+1]=e[h+1],r[o+2]=e[h+2],r[o+3]=255}return r}.bind(this),c=this._sock.get_rQi(),u=this._sock.rQwhole(),l=function(){var t=u[c+2]+1,n=t*this._fb_depth;if(this._FBU.bytes+=n,this._sock.rQwait("TIGHT palette "+e,this._FBU.bytes))return!1;var o=t<=2?1:8,l=Math.floor((this._FBU.width*o+7)/8),d=!1;if(l*this._FBU.height<12)d=!0,s=0,r=l*this._FBU.height;else{var f=c+3+n;s=1,r=0,r+=127&u[f],128&u[f]&&(s++,r+=(127&u[f+1])<<7,128&u[f+1]&&(s++,r+=u[f+2]<<14))}if(this._FBU.bytes+=s+r,this._sock.rQwait("TIGHT "+e,this._FBU.bytes))return!1;this._sock.rQskipBytes(3),this._sock.rQshiftTo(this._paletteBuff,n),this._sock.rQskipBytes(s),i=d?this._sock.rQshiftBytes(r):_(this._sock.rQshiftBytes(r),l*this._FBU.height);var p;return 2==t?(p=h(i,this._paletteBuff,this._FBU.width,this._FBU.height),this._display.blitRgbxImage(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,p,0,!1)):(p=a(i,this._paletteBuff,this._FBU.width,this._FBU.height),this._display.blitRgbxImage(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,p,0,!1)),!0}.bind(this),d=function(){var t=!1,n=this._FBU.width*this._FBU.height*this._fb_depth;if(n<12)t=!0,s=0,r=n;else{var o=c+1;s=1,r=0,r+=127&u[o],128&u[o]&&(s++,r+=(127&u[o+1])<<7,128&u[o+1]&&(s++,r+=u[o+2]<<14))}return this._FBU.bytes=1+s+r,!this._sock.rQwait("TIGHT "+e,this._FBU.bytes)&&(this._sock.rQshiftBytes(1+s),i=t?this._sock.rQshiftBytes(r):_(this._sock.rQshiftBytes(r),n),this._display.blitRgbImage(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,i,0,!1),!0)}.bind(this),f=this._sock.rQpeek8();if(n=15&f,f>>=4,o=3&f,8===f)e="fill";else if(9===f)e="jpeg";else if(10===f)e="png";else if(4&f)e="filter";else{if(!(f<4))return this._fail("Illegal tight compression received, ctl: "+f);e="copy"}if(t&&("filter"===e||"copy"===e))return this._fail("filter/copy received in tightPNG mode");switch(e){case"fill":this._FBU.bytes+=this._fb_depth;break;case"jpeg":this._FBU.bytes+=3;break;case"png":this._FBU.bytes+=3;break;case"filter":this._FBU.bytes+=2;break;case"copy":}if(this._sock.rQwait("TIGHT "+e,this._FBU.bytes))return!1;switch(e){case"fill":this._display.fillRect(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,[u[c+3],u[c+2],u[c+1]],!1),this._sock.rQskipBytes(4);break;case"png":case"jpeg":var p=c+1;if(s=1,r=0,r+=127&u[p],128&u[p]&&(s++,r+=(127&u[p+1])<<7,128&u[p+1]&&(s++,r+=u[p+2]<<14)),this._FBU.bytes=1+s+r,this._sock.rQwait("TIGHT "+e,this._FBU.bytes))return!1;this._sock.rQskipBytes(1+s);var g=new Image;g.src="data: image/"+e+RFB.extract_data_uri(this._sock.rQshiftBytes(r)),this._display.renderQ_push({type:"img",img:g,x:this._FBU.x,y:this._FBU.y}),g=null;break;case"filter":var y=u[c+1];if(1===y){if(!l())return!1}else this._fail("Unsupported tight subencoding received, filter: "+y);break;case"copy":if(!d())return!1}return this._FBU.bytes=0,this._FBU.rects--,!0},TIGHT:function(){return this._encHandlers.display_tight(!1)},TIGHT_PNG:function(){return this._encHandlers.display_tight(!0)},last_rect:function(){return this._FBU.rects=0,!0},handle_FB_resize:function(){return this._fb_width=this._FBU.width,this._fb_height=this._FBU.height,this._destBuff=new Uint8Array(this._fb_width*this._fb_height*4),this._display.resize(this._fb_width,this._fb_height),this._onFBResize(this,this._fb_width,this._fb_height),this._timing.fbu_rt_start=(new Date).getTime(),this._FBU.bytes=0,this._FBU.rects-=1,!0},ExtendedDesktopSize:function(){if(this._FBU.bytes=1,this._sock.rQwait("ExtendedDesktopSize",this._FBU.bytes))return!1;this._supportsSetDesktopSize=!0;var t=this._sock.rQpeek8();if(this._FBU.bytes=4+16*t,this._sock.rQwait("ExtendedDesktopSize",this._FBU.bytes))return!1;this._sock.rQskipBytes(1),this._sock.rQskipBytes(3);for(var e=0;e<t;e+=1)0===e?(this._screen_id=this._sock.rQshiftBytes(4),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._screen_flags=this._sock.rQshiftBytes(4)):this._sock.rQskipBytes(16);if(1===this._FBU.x&&0!==this._FBU.y){var i="";switch(this._FBU.y){case 1:i="Resize is administratively prohibited";break;case 2:i="Out of resources";break;case 3:i="Invalid screen layout";break;default:i="Unknown reason"}return Util.Info("Server did not accept the resize request: "+i),!0}return this._encHandlers.handle_FB_resize(),!0},DesktopSize:function(){return this._encHandlers.handle_FB_resize(),!0},Cursor:function(){Util.Debug(">> set_cursor");var t=this._FBU.x,e=this._FBU.y,i=this._FBU.width,s=this._FBU.height,r=i*s*this._fb_Bpp,n=Math.floor((i+7)/8)*s;return this._FBU.bytes=r+n,!this._sock.rQwait("cursor encoding",this._FBU.bytes)&&(this._display.changeCursor(this._sock.rQshiftBytes(r),this._sock.rQshiftBytes(n),t,e,i,s),this._FBU.bytes=0,this._FBU.rects--,Util.Debug("<< set_cursor"),!0)},JPEG_quality_lo:function(){Util.Error("Server sent jpeg_quality pseudo-encoding")},compress_lo:function(){Util.Error("Server sent compress level pseudo-encoding")}}}();var XK_VoidSymbol=16777215,XK_BackSpace=65288,XK_Tab=65289,XK_Linefeed=65290,XK_Clear=65291,XK_Return=65293,XK_Pause=65299,XK_Scroll_Lock=65300,XK_Sys_Req=65301,XK_Escape=65307,XK_Delete=65535,XK_Home=65360,XK_Left=65361,XK_Up=65362,XK_Right=65363,XK_Down=65364,XK_Prior=65365,XK_Page_Up=65365,XK_Next=65366,XK_Page_Down=65366,XK_End=65367,XK_Begin=65368,XK_Select=65376,XK_Print=65377,XK_Execute=65378,XK_Insert=65379,XK_Undo=65381,XK_Redo=65382,XK_Menu=65383,XK_Find=65384,XK_Cancel=65385,XK_Help=65386,XK_Break=65387,XK_Mode_switch=65406,XK_script_switch=65406,XK_Num_Lock=65407,XK_KP_Space=65408,XK_KP_Tab=65417,XK_KP_Enter=65421,XK_KP_F1=65425,XK_KP_F2=65426,XK_KP_F3=65427,XK_KP_F4=65428,XK_KP_Home=65429,XK_KP_Left=65430,XK_KP_Up=65431,XK_KP_Right=65432,XK_KP_Down=65433,XK_KP_Prior=65434,XK_KP_Page_Up=65434,XK_KP_Next=65435,XK_KP_Page_Down=65435,XK_KP_End=65436,XK_KP_Begin=65437,XK_KP_Insert=65438,XK_KP_Delete=65439,XK_KP_Equal=65469,XK_KP_Multiply=65450,XK_KP_Add=65451,XK_KP_Separator=65452,XK_KP_Subtract=65453,XK_KP_Decimal=65454,XK_KP_Divide=65455,XK_KP_0=65456,XK_KP_1=65457,XK_KP_2=65458,XK_KP_3=65459,XK_KP_4=65460,XK_KP_5=65461,XK_KP_6=65462,XK_KP_7=65463,XK_KP_8=65464,XK_KP_9=65465,XK_F1=65470,XK_F2=65471,XK_F3=65472,XK_F4=65473,XK_F5=65474,XK_F6=65475,XK_F7=65476,XK_F8=65477,XK_F9=65478,XK_F10=65479,XK_F11=65480,XK_L1=65480,XK_F12=65481,XK_L2=65481,XK_F13=65482,XK_L3=65482,XK_F14=65483,XK_L4=65483,XK_F15=65484,XK_L5=65484,XK_F16=65485,XK_L6=65485,XK_F17=65486,XK_L7=65486,XK_F18=65487,XK_L8=65487,XK_F19=65488,XK_L9=65488,XK_F20=65489,XK_L10=65489,XK_F21=65490,XK_R1=65490,XK_F22=65491,XK_R2=65491,XK_F23=65492,XK_R3=65492,XK_F24=65493,XK_R4=65493,XK_F25=65494,XK_R5=65494,XK_F26=65495,XK_R6=65495,XK_F27=65496,XK_R7=65496,XK_F28=65497,XK_R8=65497,XK_F29=65498,XK_R9=65498,XK_F30=65499,XK_R10=65499,XK_F31=65500,XK_R11=65500,XK_F32=65501,XK_R12=65501,XK_F33=65502,XK_R13=65502,XK_F34=65503,XK_R14=65503,XK_F35=65504,XK_R15=65504,XK_Shift_L=65505,XK_Shift_R=65506,XK_Control_L=65507,XK_Control_R=65508,XK_Caps_Lock=65509,XK_Shift_Lock=65510,XK_Meta_L=65511,XK_Meta_R=65512,XK_Alt_L=65513,XK_Alt_R=65514,XK_Super_L=65515,XK_Super_R=65516,XK_Hyper_L=65517,XK_Hyper_R=65518,XK_ISO_Level3_Shift=65027,XK_space=32,XK_exclam=33,XK_quotedbl=34,XK_numbersign=35,XK_dollar=36,XK_percent=37,XK_ampersand=38,XK_apostrophe=39,XK_quoteright=39,XK_parenleft=40,XK_parenright=41,XK_asterisk=42,XK_plus=43,XK_comma=44,XK_minus=45,XK_period=46,XK_slash=47,XK_0=48,XK_1=49,XK_2=50,XK_3=51,XK_4=52,XK_5=53,XK_6=54,XK_7=55,XK_8=56,XK_9=57,XK_colon=58,XK_semicolon=59,XK_less=60,XK_equal=61,XK_greater=62,XK_question=63,XK_at=64,XK_A=65,XK_B=66,XK_C=67,XK_D=68,XK_E=69,XK_F=70,XK_G=71,XK_H=72,XK_I=73,XK_J=74,XK_K=75,XK_L=76,XK_M=77,XK_N=78,XK_O=79,XK_P=80,XK_Q=81,XK_R=82,XK_S=83,XK_T=84,XK_U=85,XK_V=86,XK_W=87,XK_X=88,XK_Y=89,XK_Z=90,XK_bracketleft=91,XK_backslash=92,XK_bracketright=93,XK_asciicircum=94,XK_underscore=95,XK_grave=96,XK_quoteleft=96,XK_a=97,XK_b=98,XK_c=99,XK_d=100,XK_e=101,XK_f=102,XK_g=103,XK_h=104,XK_i=105,XK_j=106,XK_k=107,XK_l=108,XK_m=109,XK_n=110,XK_o=111,XK_p=112,XK_q=113,XK_r=114,XK_s=115,XK_t=116,XK_u=117,XK_v=118,XK_w=119,XK_x=120,XK_y=121,XK_z=122,XK_braceleft=123,XK_bar=124,XK_braceright=125,XK_asciitilde=126,XK_nobreakspace=160,XK_exclamdown=161,XK_cent=162,XK_sterling=163,XK_currency=164,XK_yen=165,XK_brokenbar=166,XK_section=167,XK_diaeresis=168,XK_copyright=169,XK_ordfeminine=170,XK_guillemotleft=171,XK_notsign=172,XK_hyphen=173,XK_registered=174,XK_macron=175,XK_degree=176,XK_plusminus=177,XK_twosuperior=178,XK_threesuperior=179,XK_acute=180,XK_mu=181,XK_paragraph=182,XK_periodcentered=183,XK_cedilla=184,XK_onesuperior=185,XK_masculine=186,XK_guillemotright=187,XK_onequarter=188,XK_onehalf=189,XK_threequarters=190,XK_questiondown=191,XK_Agrave=192,XK_Aacute=193,XK_Acircumflex=194,XK_Atilde=195,XK_Adiaeresis=196,XK_Aring=197,XK_AE=198,XK_Ccedilla=199,XK_Egrave=200,XK_Eacute=201,XK_Ecircumflex=202,XK_Ediaeresis=203,XK_Igrave=204,XK_Iacute=205,XK_Icircumflex=206,XK_Idiaeresis=207,XK_ETH=208,XK_Eth=208,XK_Ntilde=209,XK_Ograve=210,XK_Oacute=211,XK_Ocircumflex=212,XK_Otilde=213,XK_Odiaeresis=214,XK_multiply=215,XK_Oslash=216,XK_Ooblique=216,XK_Ugrave=217,XK_Uacute=218,XK_Ucircumflex=219,XK_Udiaeresis=220,XK_Yacute=221,XK_THORN=222,XK_Thorn=222,XK_ssharp=223,XK_agrave=224,XK_aacute=225,XK_acircumflex=226,XK_atilde=227,XK_adiaeresis=228,XK_aring=229,XK_ae=230,XK_ccedilla=231,XK_egrave=232,XK_eacute=233,XK_ecircumflex=234,XK_ediaeresis=235,XK_igrave=236,XK_iacute=237,XK_icircumflex=238,XK_idiaeresis=239,XK_eth=240,XK_ntilde=241,XK_ograve=242,XK_oacute=243,XK_ocircumflex=244,XK_otilde=245,XK_odiaeresis=246,XK_division=247,XK_oslash=248,XK_ooblique=248,XK_ugrave=249,XK_uacute=250,XK_ucircumflex=251,XK_udiaeresis=252,XK_yacute=253,XK_thorn=254,XK_ydiaeresis=255;!function(){function NoVnc(canvas){function afterLoaded(t){isLoaded?t():afterLoadedList.push(t)}function onUpdateState(t,e,i,s){if("normal"==e&!isLoaded){for(isLoaded=!0,desktopWidth=t.get_display().get_width(),desktopHeight=t.get_display().get_height();afterLoadedList.length>0;)afterLoadedList.shift()();$(canvas).trigger("novnc:loaded")}"connect"==e&&$(canvas).trigger("novnc:connected"),"disconnect"==e&&(reset(),$(canvas).trigger("novnc:disconnected")),"password"==e&&(console.log("password"),$(canvas).trigger("novnc:passwordrequired"))}function rescale(){var t=desktopWidth*scale,e=desktopHeight*scale;$(canvas).width(t).height(e),rfb.get_mouse().set_scale(scale)}function onFBUComplete(t,e){"DesktopSize"==e.encodingName&&(desktopWidth=e.width,desktopHeight=e.height,$(canvas).trigger("novnc:resolutionchanged"),rescale())}function reset(){rfb=void 0,afterLoadedList=[],isLoaded=!1}$(canvas).on("contextmenu",function(t){t.preventDefault()}),$(canvas).click(function(){$(this).focus()}),$(canvas).attr("tabindex",tabindexCounter),tabindexCounter++;var rfb,scale=1,desktopWidth,desktopHeight,isLoaded=!1,afterLoadedList=[];this.connect=function(t,e,i,s){return rfb||(rfb=new RFB({target:canvas,encrypt:"https:"===window.location.protocol,true_color:!0,local_cursor:!0,shared:!0,view_only:!1,focusContainer:canvas,onUpdateState:onUpdateState,onFBUComplete:onFBUComplete}),rfb.connect(t,e,i,s)),this},this.disconnect=function(){return rfb&&(rfb.disconnect(),reset()),this},this.resize=function(t,e){return rfb&&afterLoaded(function(){var i=t/desktopWidth,s=e/desktopHeight;scale=i<s?i:s,scale>1&&(scale=1),scale<.1&&(scale=.1),rescale(),$(canvas).trigger("novnc:resize")}),this},this.sendPassword=function(t){return rfb&&rfb.sendPassword(t),this},this.sendKey=function(code,down){return rfb&&("string"==typeof code&&(code=eval("XK_"+code)),rfb.sendKey(code,down)),this}}var tabindexCounter=1e6;$.fn.noVnc=function(){return $(this)[0]._noVnc||($(this)[0]._noVnc=new NoVnc($(this)[0])),$(this)[0]._noVnc}}()}(jQuery);